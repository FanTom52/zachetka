<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∑–∞—á–µ—Ç–∫–∞</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <div class="container-fluid p-0">
            <!-- –•–µ–¥–µ—Ä -->
            <header class="header">
                <div class="row align-items-center">
                    <div class="col">
                        <h1 class="mb-0">
                            <i class="bi bi-journal-bookmark-fill"></i>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∑–∞—á–µ—Ç–∫–∞
                        </h1>
                    </div>
                    <div class="col-auto">
                        <div class="d-flex align-items-center gap-3">
                            <span class="fw-bold text-dark" id="userName"></span>
                            <button onclick="logout()" class="btn btn-outline-danger btn-sm">
                                <i class="bi bi-box-arrow-right"></i>–í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò -->
            <nav class="mb-4">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="bi bi-house-door"></i>–ì–ª–∞–≤–Ω–∞—è
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('grades')">
                            <i class="bi bi-journal-check"></i>–û—Ü–µ–Ω–∫–∏
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('schedule')">
                            <i class="bi bi-calendar-week"></i>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('attendance')">
                            <i class="bi bi-clipboard-check"></i>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                        </a>
                    </li>
                    <!-- –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò –î–õ–Ø –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–ï–ô -->
                    <li class="nav-item" id="teacherStatsTab" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('teacherStats')">
                            <i class="bi bi-graph-up"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="bi bi-file-text"></i>–û—Ç—á–µ—Ç—ã
                        </a>
                    </li>

                    <!-- –í–ö–õ–ê–î–ö–ê –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò -->
                    <li class="nav-item" id="adminTab" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('admin')">
                            <i class="bi bi-shield-lock"></i>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <main>
                <!-- –ì–ª–∞–≤–Ω–∞—è -->
                <div id="dashboard" class="section active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-house-door"></i> –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                        </div>
                        <div class="card-body">
                            <p class="lead">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –∑–∞—á–µ—Ç–∫—É!</p>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="alert alert-info border-0">
                                        <h5 class="alert-heading mb-3">üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                                        <div id="userDetails" class="mb-0"></div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="stat-card">
                                        <h3>üìä –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
                                        <div class="d-grid gap-2 mt-3">
                                            <button class="btn btn-outline-primary" onclick="showSection('grades')">
                                                <i class="bi bi-journal-check"></i>–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="showSection('schedule')">
                                                <i class="bi bi-calendar-week"></i>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="showSection('attendance')">
                                                <i class="bi bi-clipboard-check"></i>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                                            </button>
                                            <button class="btn btn-outline-primary" id="quickStatsBtn" style="display:none;" onclick="showSection('teacherStats')">
                                                <i class="bi bi-graph-up"></i>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                            </button>
                                            <button class="btn btn-outline-primary" id="quickAdminBtn" style="display:none;" onclick="showSection('admin')">
                                                <i class="bi bi-shield-lock"></i>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ü–µ–Ω–∫–∏ -->
                <div id="grades" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-journal-check"></i> –ú–æ–∏ –æ—Ü–µ–Ω–∫–∏</h2>
                        </div>
                        <div class="card-body">
                            <div id="gradesList" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ü–µ–Ω–æ–∫...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
                <div id="schedule" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-calendar-week"></i> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                        </div>
                        <div class="card-body">
                            <div id="scheduleList" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å -->
                <div id="attendance" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-clipboard-check"></i> –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h2>
                        </div>
                        <div class="card-body">
                            <div id="attendanceList" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
                <div id="teacherStats" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-graph-up"></i> –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <h5 class="text-muted">–û–±–∑–æ—Ä –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h5>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-outline-primary" onclick="refreshTeacherStatistics()">
                                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            
                            <div id="teacherStatisticsContent">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>üéì –°—Ç—É–¥–µ–Ω—Ç—ã</h3>
                                        <p id="teacherStudentsCount">0</p>
                                        <small class="text-muted">–û–±—É—á–∞–µ—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìù –û—Ü–µ–Ω–∫–∏</h3>
                                        <p id="teacherGradesCount">0</p>
                                        <small class="text-muted">–ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –æ—Ü–µ–Ω–æ–∫</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìä –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h3>
                                        <p id="teacherAverageGrade">0</p>
                                        <small class="text-muted">–ü–æ –≤—Å–µ–º –ø—Ä–µ–¥–º–µ—Ç–∞–º</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìö –ü—Ä–µ–¥–º–µ—Ç—ã</h3>
                                        <p id="teacherSubjectsCount">0</p>
                                        <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞–µ–º—ã–µ</small>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="bi bi-bar-chart"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="teacherGradesDistribution" class="text-center py-3">
                                                    <div class="spinner-border spinner-border-sm" role="status">
                                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                    </div>
                                                    <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="bi bi-journal-check"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="teacherSubjectsStats" class="text-center py-3">
                                                    <div class="spinner-border spinner-border-sm" role="status">
                                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                    </div>
                                                    <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="bi bi-clock-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="teacherRecentGrades" class="text-center py-3">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                            </div>
                                            <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ç—á–µ—Ç—ã -->
                <div id="reports" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-file-text"></i> –û—Ç—á–µ—Ç—ã</h2>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                                <div class="col-md-6 mb-4" id="studentReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-person display-4 text-primary"></i>
                                            </div>
                                            <h5>–ú–æ–∏ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã</h5>
                                            <p class="text-muted">–ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã —Å –æ—Ü–µ–Ω–∫–∞–º–∏, –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary" onclick="viewStudentHTMLReport()">
                                                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å HTML –æ—Ç—á–µ—Ç
                                                </button>
                                                <button class="btn btn-pdf" onclick="exportStudentPDFReport()">
                                                    <i class="bi bi-file-pdf"></i> –°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á–µ—Ç
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π -->
                                <div class="col-md-6 mb-4" id="teacherReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-people display-4 text-success"></i>
                                            </div>
                                            <h5>–û—Ç—á–µ—Ç—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h5>
                                            <p class="text-muted">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –ø–æ –≤–∞—à–∏–º –≥—Ä—É–ø–ø–∞–º</p>
                                            <div class="mb-3">
                                                <select id="reportGroupSelect" class="form-select">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                                                </select>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success" onclick="generateGroupReport()">
                                                    <i class="bi bi-eye"></i> –û—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ
                                                </button>
                                                <button class="btn btn-outline-success" onclick="generateGroupPDFReport()">
                                                    <i class="bi bi-file-pdf"></i> PDF –≥—Ä—É–ø–ø—ã
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                                <div class="col-md-6 mb-4" id="adminReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-graph-up display-4 text-info"></i>
                                            </div>
                                            <h5>–°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</h5>
                                            <p class="text-muted">–ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-info" onclick="generateSystemReport()">
                                                    <i class="bi bi-download"></i> –û—Ç—á–µ—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ
                                                </button>
                                                <button class="btn btn-outline-info" onclick="generateAllGroupsReport()">
                                                    <i class="bi bi-download"></i> –û—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
                                <div class="col-12 mt-4" id="studentStatsSection" style="display: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="bi bi-graph-up"></i> –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="studentQuickStats" class="text-center py-3">
                                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                </div>
                                                <span class="ms-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="reportResult" class="mt-4"></div>
                        </div>
                    </div>
                </div>

                <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
                <div id="admin" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-shield-lock"></i> –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                        </div>
                        <div class="card-body">
                            <p class="lead">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π.</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="stat-card">
                                        <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                                        <p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
                                        <button onclick="window.location.href='admin.html'" class="btn btn-primary w-100">
                                            <i class="bi bi-people"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="stat-card">
                                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                                        <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
                                        <button onclick="window.location.href='admin.html'" class="btn btn-primary w-100">
                                            <i class="bi bi-graph-up"></i> –°–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let currentUser = null;
        const token = localStorage.getItem('token');

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è–º
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            const sections = document.getElementsByClassName('section');
            for (let i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }

            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionName).classList.add('active');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ
            event.currentTarget.classList.add('active');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
            loadSectionData(sectionName);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ü–∏–π
        async function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'grades':
                    await loadGrades();
                    break;
                case 'schedule':
                    await loadSchedule();
                    break;
                case 'attendance':
                    await loadAttendance();
                    break;
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'teacherStats':
                    await loadTeacherStatistics();
                    break;
                case 'reports':
                    showReportSections();
                    break;
            }
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –û–¢–ß–ï–¢–û–í ====================

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
        function showReportSections() {
            document.getElementById('studentReportSection').style.display = currentUser.role === 'student' ? 'block' : 'none';
            document.getElementById('teacherReportSection').style.display = currentUser.role === 'teacher' ? 'block' : 'none';
            document.getElementById('adminReportSection').style.display = currentUser.role === 'admin' ? 'block' : 'none';
            document.getElementById('studentStatsSection').style.display = currentUser.role === 'student' ? 'block' : 'none';

            if (currentUser.role === 'teacher') {
                loadTeacherGroupsForReports();
            }
            
            if (currentUser.role === 'student') {
                loadStudentStats();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
        async function loadStudentStats() {
            try {
                const response = await fetch('/api/student/statistics', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    document.getElementById('studentQuickStats').innerHTML = `
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-primary fs-5">${stats.totalGrades}</div>
                                    <small class="text-muted">–û—Ü–µ–Ω–æ–∫</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-success fs-5">${stats.averageGrade}</div>
                                    <small class="text-muted">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-info fs-5">${stats.attendancePercentage}%</div>
                                    <small class="text-muted">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-warning fs-5">${stats.attendance.absent}</div>
                                    <small class="text-muted">–ü—Ä–æ–ø—É—Å–∫–æ–≤</small>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()}</small>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('studentQuickStats').innerHTML = `
                    <div class="alert alert-warning py-2">
                        <small>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</small>
                    </div>
                `;
            }
        }

        // HTML –æ—Ç—á–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
        function viewStudentHTMLReport() {
            const token = localStorage.getItem('token');
            const url = `/api/student/report/html?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('HTML –æ—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ...', 'success');
        }

        // PDF –æ—Ç—á–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
        function exportStudentPDFReport() {
            const token = localStorage.getItem('token');
            const url = `/api/student/report/pdf?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('PDF –æ—Ç—á–µ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
        async function loadTeacherGroupsForReports() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/groups`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                const select = document.getElementById('reportGroupSelect');
                
                if (result.success) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>';
                    result.data.forEach(group => {
                        const option = document.createElement('option');
                        option.value = group.id;
                        option.textContent = group.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading groups for reports:', error);
            }
        }

        // HTML –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å —Ç–æ–∫–µ–Ω–æ–º
        function generateGroupReport() {
            const groupId = document.getElementById('reportGroupSelect').value;
            const token = localStorage.getItem('token');
            
            if (!groupId) {
                showReportMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É', 'warning');
                return;
            }

            const url = `/api/statistics/group/${groupId}/html?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('HTML –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // PDF –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å —Ç–æ–∫–µ–Ω–æ–º
        function generateGroupPDFReport() {
            const groupId = document.getElementById('reportGroupSelect').value;
            const token = localStorage.getItem('token');
            
            if (!groupId) {
                showReportMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É', 'warning');
                return;
            }

            const url = `/api/statistics/group/${groupId}/pdf?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('PDF –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
        function generateSystemReport() {
            showReportMessage('–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function generateAllGroupsReport() {
            showReportMessage('–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –ø–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
        function showReportMessage(message, type) {
            const alertClass = {
                'success': 'alert-success',
                'warning': 'alert-warning', 
                'info': 'alert-info',
                'error': 'alert-danger'
            }[type] || 'alert-info';
            
            document.getElementById('reportResult').innerHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const alert = document.querySelector('#reportResult .alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // ==================== –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò ====================

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function checkAuth() {
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', currentUser);
                    displayUserInfo();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω –≤–∫–ª–∞–¥–∫—É –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
                    if (currentUser.role === 'admin') {
                        document.getElementById('adminTab').style.display = 'block';
                        document.getElementById('quickAdminBtn').style.display = 'block';
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
                    if (currentUser.role === 'teacher') {
                        document.getElementById('teacherStatsTab').style.display = 'block';
                        document.getElementById('quickStatsBtn').style.display = 'block';
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ–∫—Ü–∏–∏
                    loadSectionData('dashboard');
                } else {
                    console.log('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', result.error);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('‚ùå Auth error:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        function displayUserInfo() {
            document.getElementById('userName').textContent = currentUser.username;
        }

        async function loadGrades() {
            try {
                let url = '';
                let title = '';
                
                if (currentUser.role === 'student' && currentUser.student_id) {
                    url = `/api/grades/student/${currentUser.student_id}`;
                    title = '–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏';
                } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    url = `/api/grades/teacher/${currentUser.teacher_id}`;
                    title = '–û—Ü–µ–Ω–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤';
                } else {
                    document.getElementById('gradesList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ü–µ–Ω–∫–∞—Ö</h5>
                            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</p>
                        </div>
                    `;
                    return;
                }

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    let html = `
                        <h5 class="mb-4">${title}</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                    `;
                    
                    if (currentUser.role === 'student') {
                        html += `
                            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                            <th>–û—Ü–µ–Ω–∫–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                        `;
                    } else {
                        html += `
                            <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                            <th>–ì—Ä—É–ø–ø–∞</th>
                            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                            <th>–û—Ü–µ–Ω–∫–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–î–∞—Ç–∞</th>
                        `;
                    }
                    
                    html += `</tr></thead><tbody>`;
                    
                    result.data.forEach(grade => {
                        if (currentUser.role === 'student') {
                            html += `
                                <tr>
                                    <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>
                                        <span class="badge bg-${grade.grade >= 4 ? 'success' : grade.grade >= 3 ? 'warning' : 'danger'} fs-6">
                                            ${grade.grade}
                                        </span>
                                    </td>
                                    <td>${grade.grade_type || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${new Date(grade.date).toLocaleDateString()}</td>
                                    <td>${grade.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                </tr>
                            `;
                        } else {
                            html += `
                                <tr>
                                    <td>${grade.student_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${grade.group_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>
                                        <span class="badge bg-${grade.grade >= 4 ? 'success' : grade.grade >= 3 ? 'warning' : 'danger'} fs-6">
                                            ${grade.grade}
                                        </span>
                                    </td>
                                    <td>${grade.grade_type || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${new Date(grade.date).toLocaleDateString()}</td>
                                </tr>
                            `;
                        }
                    });
                    
                    html += `</tbody></table></div>`;
                    document.getElementById('gradesList').innerHTML = html;
                } else {
                    document.getElementById('gradesList').innerHTML = `
                        <div class="alert alert-warning">
                            <h5>–û—Ü–µ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                            <p>${currentUser.role === 'student' ? '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫.' : '–í—ã –ø–æ–∫–∞ –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading grades:', error);
                document.getElementById('gradesList').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –æ—Ü–µ–Ω–∫–∞—Ö.</p>
                    </div>
                `;
            }
        }

        async function loadSchedule() {
            try {
                let url = '';
                if (currentUser.role === 'student' && currentUser.student_id) {
                    url = `/api/schedule/student/${currentUser.student_id}`;
                } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    url = `/api/schedule/teacher/${currentUser.teacher_id}`;
                } else {
                    document.getElementById('scheduleList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h5>
                            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</p>
                        </div>
                    `;
                    return;
                }

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success && result.data.schedule && result.data.schedule.length > 0) {
                    const schedule = result.data.schedule;
                    let html = `
                        <h5 class="mb-4">–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–î–µ–Ω—å</th>
                                        <th>–í—Ä–µ–º—è</th>
                                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                        <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                        <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    const days = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
                    
                    schedule.forEach(item => {
                        html += `
                            <tr>
                                <td>${days[item.day_of_week - 1] || item.day_of_week}</td>
                                <td>${item.start_time} - ${item.end_time}</td>
                                <td>${item.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${item.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${item.classroom || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                            </tr>
                        `;
                    });
                    
                    html += `</tbody></table></div>`;
                    document.getElementById('scheduleList').innerHTML = html;
                } else {
                    document.getElementById('scheduleList').innerHTML = `
                        <div class="alert alert-warning">
                            <h5>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                            <p>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∞—Å –ø–æ–∫–∞ –Ω–µ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–æ.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading schedule:', error);
                document.getElementById('scheduleList').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.</p>
                    </div>
                `;
            }
        }

        async function loadAttendance() {
            try {
                if (currentUser.role === 'student' && currentUser.student_id) {
                    const response = await fetch(`/api/attendance/student/${currentUser.student_id}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const result = await response.json();
                    
                    if (result.success && result.data.attendance && result.data.attendance.length > 0) {
                        const attendance = result.data.attendance;
                        let html = `
                            <h5 class="mb-4">–ú–æ—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>–î–∞—Ç–∞</th>
                                            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        attendance.forEach(item => {
                            const statusBadge = item.status === 'present' ? 
                                '<span class="badge bg-success">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>' :
                                '<span class="badge bg-danger">–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>';
                            
                            html += `
                                <tr>
                                    <td>${new Date(item.date).toLocaleDateString()}</td>
                                    <td>${item.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${statusBadge}</td>
                                    <td>${item.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                </tr>
                            `;
                        });
                        
                        html += `</tbody></table></div>`;
                        document.getElementById('attendanceList').innerHTML = html;
                    } else {
                        document.getElementById('attendanceList').innerHTML = `
                            <div class="alert alert-warning">
                                <h5>–î–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏.</p>
                            </div>
                        `;
                    }
                } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    document.getElementById('attendanceList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <p>–î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</p>
                        </div>
                    `;
                } else {
                    document.getElementById('attendanceList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading attendance:', error);
                document.getElementById('attendanceList').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏.</p>
                    </div>
                `;
            }
        }

        async function loadTeacherStatistics() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/statistics`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
                    document.getElementById('teacherStudentsCount').textContent = stats.students_count;
                    document.getElementById('teacherGradesCount').textContent = stats.grades_count;
                    document.getElementById('teacherAverageGrade').textContent = stats.average_grade;
                    document.getElementById('teacherSubjectsCount').textContent = stats.subjects_stats.length;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
                    if (stats.grades_distribution && stats.grades_distribution.length > 0) {
                        let html = '';
                        const total = stats.grades_distribution.reduce((sum, d) => sum + d.count, 0);
                        
                        stats.grades_distribution.forEach(item => {
                            const percentage = total > 0 ? Math.round((item.count / total) * 100) : 0;
                            
                            html += `
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>–û—Ü–µ–Ω–∫–∞ ${item.grade}</span>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="progress" style="width: 100px;">
                                            <div class="progress-bar bg-${item.grade >= 4 ? 'success' : item.grade >= 3 ? 'warning' : 'danger'}" 
                                                 style="width: ${percentage}%"></div>
                                        </div>
                                        <small class="text-muted">${item.count} (${percentage}%)</small>
                                    </div>
                                </div>
                            `;
                        });
                        document.getElementById('teacherGradesDistribution').innerHTML = html;
                    } else {
                        document.getElementById('teacherGradesDistribution').innerHTML = '<p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –æ—Ü–µ–Ω–æ–∫</p>';
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
                    if (stats.subjects_stats && stats.subjects_stats.length > 0) {
                        let html = '';
                        stats.subjects_stats.forEach(subject => {
                            const avgGrade = subject.average_grade ? Math.round(subject.average_grade * 100) / 100 : 0;
                            const gradeCount = subject.grade_count || 0;
                            
                            html += `
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-truncate" style="max-width: 150px;" title="${subject.name}">
                                        ${subject.name}
                                    </span>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-primary">${avgGrade}</span>
                                        <small class="text-muted">(${gradeCount})</small>
                                    </div>
                                </div>
                            `;
                        });
                        document.getElementById('teacherSubjectsStats').innerHTML = html;
                    } else {
                        document.getElementById('teacherSubjectsStats').innerHTML = '<p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</p>';
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
                    await loadTeacherRecentGrades();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error loading teacher statistics:', error);
                document.getElementById('teacherStatisticsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
                        <p class="small">${error.message}</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        async function loadTeacherRecentGrades() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/recent-grades`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    let html = `
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr>
                                        <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                        <th>–û—Ü–µ–Ω–∫–∞</th>
                                        <th>–î–∞—Ç–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    result.data.forEach(grade => {
                        html += `
                            <tr>
                                <td>${grade.student_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>
                                    <span class="badge bg-${grade.grade >= 4 ? 'success' : grade.grade >= 3 ? 'warning' : 'danger'}">
                                        ${grade.grade}
                                    </span>
                                </td>
                                <td>${new Date(grade.date).toLocaleDateString()}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('teacherRecentGrades').innerHTML = html;
                } else {
                    document.getElementById('teacherRecentGrades').innerHTML = 
                        '<p class="text-muted">–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                }
            } catch (error) {
                console.error('Error loading recent grades:', error);
                document.getElementById('teacherRecentGrades').innerHTML = 
                    '<p class="text-muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        function refreshTeacherStatistics() {
            loadTeacherStatistics();
        }

        async function loadDashboard() {
            try {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfoDiv = document.getElementById('userDetails');
                let baseHtml = `
                    <p class="mb-2"><strong>üë§ –õ–æ–≥–∏–Ω:</strong> ${currentUser.username}</p>
                    <p class="mb-2"><strong>üéØ –†–æ–ª—å:</strong> <span class="${getRoleClass(currentUser.role)} role-badge">${getRoleText(currentUser.role)}</span></p>
                    ${currentUser.student_id ? `<p class="mb-2"><strong>üéì ID —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong> ${currentUser.student_id}</p>` : ''}
                    ${currentUser.teacher_id ? `<p class="mb-0"><strong>üë®‚Äçüè´ ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</strong> ${currentUser.teacher_id}</p>` : ''}
                `;

                // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
                if (currentUser.role === 'student' && currentUser.student_id) {
                    const response = await fetch(`/api/grades/student/${currentUser.student_id}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const result = await response.json();
                    
                    if (result.success && result.data.length > 0) {
                        baseHtml += `
                            <div class="mt-3 pt-3 border-top">
                                <h6 class="mb-2">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏:</h6>
                                <div class="list-group list-group-flush">
                        `;
                        
                        result.data.slice(0, 5).forEach(grade => {
                            baseHtml += `
                                <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                                    <small>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                    <span class="badge bg-${grade.grade >= 4 ? 'success' : grade.grade >= 3 ? 'warning' : 'danger'}">
                                        ${grade.grade}
                                    </span>
                                </div>
                            `;
                        });
                        
                        baseHtml += `</div></div>`;
                    }
                }
                
                // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±—ã—Å—Ç—Ä—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    const response = await fetch(`/api/teacher/${currentUser.teacher_id}/statistics`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        const stats = result.data;
                        baseHtml += `
                            <div class="mt-3 pt-3 border-top">
                                <h6 class="mb-2">üìä –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h6>
                                <div class="row small">
                                    <div class="col-6">
                                        <strong>–°—Ç—É–¥–µ–Ω—Ç–æ–≤:</strong><br>
                                        <span class="text-primary">${stats.students_count}</span>
                                    </div>
                                    <div class="col-6">
                                        <strong>–û—Ü–µ–Ω–æ–∫:</strong><br>
                                        <span class="text-primary">${stats.grades_count}</span>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <strong>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong><br>
                                        <span class="text-primary">${stats.average_grade}</span>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <strong>–ü—Ä–µ–¥–º–µ—Ç–æ–≤:</strong><br>
                                        <span class="text-primary">${stats.subjects_stats?.length || 0}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                // –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                if (currentUser.role === 'admin') {
                    const response = await fetch('/api/statistics/overview', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        const stats = result.data;
                        baseHtml += `
                            <div class="mt-3 pt-3 border-top">
                                <h6 class="mb-2">üè¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:</h6>
                                <div class="row small">
                                    <div class="col-6">
                                        <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong><br>
                                        <span class="text-primary">${stats.users || 0}</span>
                                    </div>
                                    <div class="col-6">
                                        <strong>–°—Ç—É–¥–µ–Ω—Ç–æ–≤:</strong><br>
                                        <span class="text-primary">${stats.students || 0}</span>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <strong>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:</strong><br>
                                        <span class="text-primary">${stats.teachers || 0}</span>
                                    </div>
                                    <div class="col-6 mt-2">
                                        <strong>–û—Ü–µ–Ω–æ–∫:</strong><br>
                                        <span class="text-primary">${stats.grades || 0}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HTML
                userInfoDiv.innerHTML = baseHtml;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const userInfoDiv = document.getElementById('userDetails');
                userInfoDiv.innerHTML = `
                    <p class="mb-2"><strong>üë§ –õ–æ–≥–∏–Ω:</strong> ${currentUser.username}</p>
                    <p class="mb-2"><strong>üéØ –†–æ–ª—å:</strong> <span class="${getRoleClass(currentUser.role)} role-badge">${getRoleText(currentUser.role)}</span></p>
                    ${currentUser.student_id ? `<p class="mb-2"><strong>üéì ID —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong> ${currentUser.student_id}</p>` : ''}
                    ${currentUser.teacher_id ? `<p class="mb-0"><strong>üë®‚Äçüè´ ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</strong> ${currentUser.teacher_id}</p>` : ''}
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-muted small">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</p>
                    </div>
                `;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–æ–ª–µ–π
        function getRoleText(role) {
            switch(role) {
                case 'admin': return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                case 'teacher': return '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å';
                case 'student': return '–°—Ç—É–¥–µ–Ω—Ç';
                default: return role;
            }
        }

        function getRoleClass(role) {
            switch(role) {
                case 'admin': return 'role-admin';
                case 'teacher': return 'role-teacher';
                case 'student': return 'role-student';
                default: return '';
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        checkAuth();
    </script>

    <style>
        .btn-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-pdf:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .role-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .role-admin {
            background-color: #dc3545;
            color: white;
        }
        .role-teacher {
            background-color: #fd7e14;
            color: white;
        }
        .role-student {
            background-color: #20c997;
            color: white;
        }
    </style>
</body>
</html>