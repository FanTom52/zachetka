<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∑–∞—á–µ—Ç–∫–∞</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <div class="container-fluid p-0">
            <!-- –•–µ–¥–µ—Ä -->
            <header class="header">
                <div class="row align-items-center">
                    <div class="col">
                        <h1 class="mb-0">
                            <i class="bi bi-journal-bookmark-fill"></i>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∑–∞—á–µ—Ç–∫–∞
                        </h1>
                    </div>
                    <div class="col-auto">
                        <div class="d-flex align-items-center gap-3">
                            <span class="fw-bold text-dark" id="userName"></span>
                            <button onclick="logout()" class="btn btn-outline-danger btn-sm">
                                <i class="bi bi-box-arrow-right"></i>–í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- –ü–ê–ù–ï–õ–¨ –ù–ê–í–ò–ì–ê–¶–ò–ò -->
            <nav class="mb-4">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="bi bi-house-door"></i>–ì–ª–∞–≤–Ω–∞—è
                        </a>
                    </li>
                   <li class="nav-item">
    <a class="nav-link" href="#" onclick="showSection('grades')">
        <i class="bi bi-journal-check"></i>–û—Ü–µ–Ω–∫–∏
    </a>
</li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('schedule')">
                            <i class="bi bi-calendar-week"></i>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('attendance')">
                            <i class="bi bi-clipboard-check"></i>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                        </a>
                    </li>
                    <!-- –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò –î–õ–Ø –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–ï–ô -->
                    <li class="nav-item" id="teacherStatsTab" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('teacherStats')">
                            <i class="bi bi-graph-up"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="bi bi-file-text"></i>–û—Ç—á–µ—Ç—ã
                        </a>
                    </li>

                    <!-- –í–ö–õ–ê–î–ö–ê –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–ò -->
                    <li class="nav-item" id="adminTab" style="display:none;">
                        <a class="nav-link" href="#" onclick="showSection('admin')">
                            <i class="bi bi-shield-lock"></i>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
            <main>
                <!-- –ì–ª–∞–≤–Ω–∞—è -->
                <div id="dashboard" class="section active">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-house-door"></i> –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                        </div>
                        <div class="card-body">
                            <p class="lead">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –∑–∞—á–µ—Ç–∫—É!</p>
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="alert alert-info border-0">
                                        <h5 class="alert-heading mb-3">üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                                        <div id="userDetails" class="mb-0"></div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="stat-card">
                                        <h3>üìä –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
                                        <div class="d-grid gap-2 mt-3">
                                            <button class="btn btn-outline-primary" onclick="showSection('grades')">
                                                <i class="bi bi-journal-check"></i>–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="showSection('schedule')">
                                                <i class="bi bi-calendar-week"></i>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="showSection('attendance')">
                                                <i class="bi bi-clipboard-check"></i>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                                            </button>
                                            <button class="btn btn-outline-primary" id="quickStatsBtn" style="display:none;" onclick="showSection('teacherStats')">
                                                <i class="bi bi-graph-up"></i>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                                            </button>
                                            <button class="btn btn-outline-primary" id="quickAdminBtn" style="display:none;" onclick="showSection('admin')">
                                                <i class="bi bi-shield-lock"></i>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ü–µ–Ω–∫–∏ -->
<div id="grades" class="section">
    <div class="card">
        <div class="card-header">
            <h2 class="mb-0"><i class="bi bi-journal-check"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∞–º–∏</h2>
        </div>
        <div class="card-body">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ –æ—Ü–µ–Ω–æ–∫ -->
            <ul class="nav nav-pills mb-4" id="gradesTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="current-grades-tab" data-bs-toggle="tab" 
                            data-bs-target="#current-grades" type="button" role="tab" aria-controls="current-grades" aria-selected="true">
                        <i class="bi bi-list-check"></i> –¢–µ–∫—É—â–∏–µ –æ—Ü–µ–Ω–∫–∏
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="add-grades-tab" data-bs-toggle="tab" 
                            data-bs-target="#add-grades" type="button" role="tab" aria-controls="add-grades" aria-selected="false">
                        <i class="bi bi-plus-circle"></i> –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
                    </button>
                </li>
            </ul>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
            <div class="tab-content" id="gradesTabsContent">
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫ -->
                <div class="tab-pane fade show active" id="current-grades" role="tabpanel" aria-labelledby="current-grades-tab">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏</h5>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshCurrentGrades()">
                                <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    <div id="currentGradesList">
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                            <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ü–µ–Ω–æ–∫...</p>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ -->
                <div class="tab-pane fade" id="add-grades" role="tabpanel" aria-labelledby="add-grades-tab">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label">–ì—Ä—É–ø–ø–∞ *</label>
                            <select class="form-select" id="gradingGroupSelect">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                            <select class="form-select" id="gradingSubjectSelect">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–¢–∏–ø —Ä–∞–±–æ—Ç—ã *</label>
                            <select class="form-select" id="gradingTypeSelect" onchange="updateGradingInterface()">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                                <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
                                <option value="credit">–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç</option>
                                <option value="test">–ó–∞—á—ë—Ç</option>
                                <option value="coursework">–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞</option>
                                <option value="practice">–ü—Ä–∞–∫—Ç–∏–∫–∞</option>
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">–î–∞—Ç–∞ *</label>
                            <input type="date" class="form-control" id="gradingDate">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">–û–±—â–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                            <input type="text" class="form-control" id="gradingCommonNotes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...">
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6>–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h6>
                        <div class="btn-group">
                            <button class="btn btn-outline-success btn-sm" onclick="loadStudentsForGrading()">
                                <i class="bi bi-arrow-clockwise"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                            </button>
                            <button class="btn btn-success btn-sm" onclick="submitAllGrades()">
                                <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ
                            </button>
                        </div>
                    </div>

                    <div id="gradingStudentsList">
                        <div class="alert alert-info">
                            <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

                <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
<div id="schedule" class="section">
    <div class="card">
        <div class="card-header">
            <h2 class="mb-0"><i class="bi bi-calendar-week"></i> –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏</h2>
        </div>
        <div class="card-body">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–æ–≤ -->
            <div id="scheduleControls" style="display: none;" class="mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏</h5>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="showAddSessionEventModal()">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
                        </button>
                        <button class="btn btn-outline-secondary" onclick="loadSessionSchedule()">
                            <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <!-- –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
            <div id="studentScheduleHeader" style="display: none;" class="mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h5>–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏</h5>
                    <button class="btn btn-outline-primary" onclick="loadSessionSchedule()">
                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <div id="sessionScheduleList">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏...</p>
                </div>
            </div>
        </div>
    </div>
</div>

                <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å -->
<div id="attendance" class="section">
    <div class="card">
        <div class="card-header">
            <h2 class="mb-0"><i class="bi bi-clipboard-check"></i> –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h2>
        </div>
        <div class="card-body">
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π -->
            <div id="attendanceControls" style="display: none;" class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>–û—Ç–º–µ—Ç–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h5>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="showMarkAttendanceModal()">
                            <i class="bi bi-check2-square"></i> –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                        </button>
                        <button class="btn btn-outline-secondary" onclick="loadAttendanceData()">
                            <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>

            <!-- –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
            <div id="studentAttendanceHeader" style="display: none;" class="mb-4">
                <div class="d-flex justify-content-between align-items-center">
                    <h5>–ú–æ—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                    <button class="btn btn-outline-primary" onclick="loadAttendanceData()">
                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ -->
            <div id="attendanceStats" class="mb-4" style="display: none;">
                <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            </div>

            <div id="attendanceList">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏...</p>
                </div>
            </div>
        </div>
    </div>
</div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
                <div id="teacherStats" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-graph-up"></i> –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-8">
                                    <h5 class="text-muted">–û–±–∑–æ—Ä –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h5>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-outline-primary" onclick="refreshTeacherStatistics()">
                                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            
                            <div id="teacherStatisticsContent">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <h3>üéì –°—Ç—É–¥–µ–Ω—Ç—ã</h3>
                                        <p id="teacherStudentsCount">0</p>
                                        <small class="text-muted">–û–±—É—á–∞–µ—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìù –û—Ü–µ–Ω–∫–∏</h3>
                                        <p id="teacherGradesCount">0</p>
                                        <small class="text-muted">–ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –æ—Ü–µ–Ω–æ–∫</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìä –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h3>
                                        <p id="teacherAverageGrade">0</p>
                                        <small class="text-muted">–ü–æ –≤—Å–µ–º –ø—Ä–µ–¥–º–µ—Ç–∞–º</small>
                                    </div>
                                    <div class="stat-card">
                                        <h3>üìö –ü—Ä–µ–¥–º–µ—Ç—ã</h3>
                                        <p id="teacherSubjectsCount">0</p>
                                        <small class="text-muted">–ü—Ä–µ–ø–æ–¥–∞–≤–∞–µ–º—ã–µ</small>
                                    </div>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="bi bi-bar-chart"></i> –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="teacherGradesDistribution" class="text-center py-3">
                                                    <div class="spinner-border spinner-border-sm" role="status">
                                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                    </div>
                                                    <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-header">
                                                <h6 class="mb-0"><i class="bi bi-journal-check"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="teacherSubjectsStats" class="text-center py-3">
                                                    <div class="spinner-border spinner-border-sm" role="status">
                                                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                    </div>
                                                    <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <h6 class="mb-0"><i class="bi bi-clock-history"></i> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="teacherRecentGrades" class="text-center py-3">
                                            <div class="spinner-border spinner-border-sm" role="status">
                                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                            </div>
                                            <p class="mt-2 small">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –û—Ç—á–µ—Ç—ã -->
                <div id="reports" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-file-text"></i> –û—Ç—á–µ—Ç—ã</h2>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                                <div class="col-md-6 mb-4" id="studentReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-person display-4 text-primary"></i>
                                            </div>
                                            <h5>–ú–æ–∏ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã</h5>
                                            <p class="text-muted">–ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã —Å –æ—Ü–µ–Ω–∫–∞–º–∏, –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-primary" onclick="viewStudentHTMLReport()">
                                                    <i class="bi bi-eye"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å HTML –æ—Ç—á–µ—Ç
                                                </button>
                                                <button class="btn btn-pdf" onclick="exportStudentPDFReport()">
                                                    <i class="bi bi-file-pdf"></i> –°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á–µ—Ç
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π -->
                                <div class="col-md-6 mb-4" id="teacherReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-people display-4 text-success"></i>
                                            </div>
                                            <h5>–û—Ç—á–µ—Ç—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h5>
                                            <p class="text-muted">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –ø–æ –≤–∞—à–∏–º –≥—Ä—É–ø–ø–∞–º</p>
                                            <div class="mb-3">
                                                <select id="reportGroupSelect" class="form-select">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                                                </select>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-success" onclick="generateGroupReport()">
                                                    <i class="bi bi-eye"></i> –û—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ
                                                </button>
                                                <button class="btn btn-outline-success" onclick="generateGroupPDFReport()">
                                                    <i class="bi bi-file-pdf"></i> PDF –≥—Ä—É–ø–ø—ã
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                                <div class="col-md-6 mb-4" id="adminReportSection" style="display: none;">
                                    <div class="card h-100 border-0 shadow-sm">
                                        <div class="card-body text-center">
                                            <div class="mb-3">
                                                <i class="bi bi-graph-up display-4 text-info"></i>
                                            </div>
                                            <h5>–°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</h5>
                                            <p class="text-muted">–ü–æ–ª–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-info" onclick="generateSystemReport()">
                                                    <i class="bi bi-download"></i> –û—Ç—á–µ—Ç –ø–æ —Å–∏—Å—Ç–µ–º–µ
                                                </button>
                                                <button class="btn btn-outline-info" onclick="generateAllGroupsReport()">
                                                    <i class="bi bi-download"></i> –û—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
                                <div class="col-12 mt-4" id="studentStatsSection" style="display: none;">
                                    <div class="card">
                                        <div class="card-header">
                                            <h6 class="mb-0"><i class="bi bi-graph-up"></i> –ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="studentQuickStats" class="text-center py-3">
                                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                                                </div>
                                                <span class="ms-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="reportResult" class="mt-4"></div>
                        </div>
                    </div>
                </div>

                <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
                <div id="admin" class="section">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="mb-0"><i class="bi bi-shield-lock"></i> –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                        </div>
                        <div class="card-body">
                            <p class="lead">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π.</p>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="stat-card">
                                        <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                                        <p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
                                        <button onclick="window.location.href='admin.html'" class="btn btn-primary w-100">
                                            <i class="bi bi-people"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="stat-card">
                                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                                        <p>–ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</p>
                                        <button onclick="window.location.href='admin.html'" class="btn btn-primary w-100">
                                            <i class="bi bi-graph-up"></i> –°–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let currentUser = null;
        const token = localStorage.getItem('token');

        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è–º
function showSection(sectionName) {
    console.log('–ü–æ–∫–∞–∑ —Å–µ–∫—Ü–∏–∏:', sectionName);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
    const sections = document.getElementsByClassName('section');
    for (let i = 0; i < sections.length; i++) {
        sections[i].classList.remove('active');
    }

    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
    const navLinks = document.querySelectorAll('.nav-tabs .nav-link');
    navLinks.forEach(link => link.classList.remove('active'));

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
    const targetSection = document.getElementById(sectionName);
    if (targetSection) {
        targetSection.classList.add('active');
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –≤–∫–ª–∞–¥–∫–µ
    event.currentTarget.classList.add('active');

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–µ–∫—Ü–∏–∏
    loadSectionData(sectionName);
}

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ–∫—Ü–∏–π
async function loadSectionData(sectionName) {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ü–∏–∏:', sectionName);
    
    switch(sectionName) {
        case 'dashboard':
            await loadDashboard();
            break;
        case 'grades':
            initGradesTabs();
            if (document.getElementById('current-grades-tab').classList.contains('active')) {
                await loadCurrentGrades();
            } else {
                await initializeGradingTab();
            }
            break;
        case 'schedule':
            await loadSessionSchedule();
            break;
        case 'attendance':
            setupAttendanceUI();
            await loadAttendance();
            break;
        case 'teacherStats':
            await loadAttendanceData();
            break;
        case 'reports':
            showReportSections();
            break;
        case 'admin':
            // –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —É–∂–µ –∏–º–µ–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            break;
        default:
            console.log('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–µ–∫—Ü–∏—è:', sectionName);
    }
}

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –û–¢–ß–ï–¢–û–í ====================

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤
        function showReportSections() {
            document.getElementById('studentReportSection').style.display = currentUser.role === 'student' ? 'block' : 'none';
            document.getElementById('teacherReportSection').style.display = currentUser.role === 'teacher' ? 'block' : 'none';
            document.getElementById('adminReportSection').style.display = currentUser.role === 'admin' ? 'block' : 'none';
            document.getElementById('studentStatsSection').style.display = currentUser.role === 'student' ? 'block' : 'none';

            if (currentUser.role === 'teacher') {
                loadTeacherGroupsForReports();
            }
            
            if (currentUser.role === 'student') {
                loadStudentStats();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞
        async function loadStudentStats() {
            try {
                const response = await fetch('/api/student/statistics', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    document.getElementById('studentQuickStats').innerHTML = `
                        <div class="row text-center">
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-primary fs-5">${stats.totalGrades}</div>
                                    <small class="text-muted">–û—Ü–µ–Ω–æ–∫</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-success fs-5">${stats.averageGrade}</div>
                                    <small class="text-muted">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-info fs-5">${stats.attendancePercentage}%</div>
                                    <small class="text-muted">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2 bg-light">
                                    <div class="fw-bold text-warning fs-5">${stats.attendance.absent}</div>
                                    <small class="text-muted">–ü—Ä–æ–ø—É—Å–∫–æ–≤</small>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleTimeString()}</small>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('studentQuickStats').innerHTML = `
                    <div class="alert alert-warning py-2">
                        <small>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</small>
                    </div>
                `;
            }
        }

        // HTML –æ—Ç—á–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
        function viewStudentHTMLReport() {
            const token = localStorage.getItem('token');
            const url = `/api/student/report/html?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('HTML –æ—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ...', 'success');
        }

        // PDF –æ—Ç—á–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
        function exportStudentPDFReport() {
            const token = localStorage.getItem('token');
            const url = `/api/student/report/pdf?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('PDF –æ—Ç—á–µ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
        async function loadTeacherGroupsForReports() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/groups`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                const select = document.getElementById('reportGroupSelect');
                
                if (result.success) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>';
                    result.data.forEach(group => {
                        const option = document.createElement('option');
                        option.value = group.id;
                        option.textContent = group.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading groups for reports:', error);
            }
        }

        // HTML –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å —Ç–æ–∫–µ–Ω–æ–º
        function generateGroupReport() {
            const groupId = document.getElementById('reportGroupSelect').value;
            const token = localStorage.getItem('token');
            
            if (!groupId) {
                showReportMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É', 'warning');
                return;
            }

            const url = `/api/statistics/group/${groupId}/html?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('HTML –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // PDF –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å —Ç–æ–∫–µ–Ω–æ–º
        function generateGroupPDFReport() {
            const groupId = document.getElementById('reportGroupSelect').value;
            const token = localStorage.getItem('token');
            
            if (!groupId) {
                showReportMessage('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É', 'warning');
                return;
            }

            const url = `/api/statistics/group/${groupId}/pdf?token=${encodeURIComponent(token)}`;
            window.open(url, '_blank');
            showReportMessage('PDF –æ—Ç—á–µ—Ç –ø–æ –≥—Ä—É–ø–ø–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...', 'success');
        }

        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
        function generateSystemReport() {
            showReportMessage('–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function generateAllGroupsReport() {
            showReportMessage('–§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –ø–æ –≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
        function showReportMessage(message, type) {
            const alertClass = {
                'success': 'alert-success',
                'warning': 'alert-warning', 
                'info': 'alert-info',
                'error': 'alert-danger'
            }[type] || 'alert-info';
            
            document.getElementById('reportResult').innerHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                const alert = document.querySelector('#reportResult .alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        // ==================== –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò ====================

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
async function checkAuth() {
    if (!token) {
        window.location.href = 'login.html';
        return;
    }

    try {
        const response = await fetch('/api/auth/me', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success) {
            currentUser = result.user;
            console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', currentUser);
            displayUserInfo();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω –≤–∫–ª–∞–¥–∫—É –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω
            if (currentUser.role === 'admin') {
                document.getElementById('adminTab').style.display = 'block';
                document.getElementById('quickAdminBtn').style.display = 'block';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
            if (currentUser.role === 'teacher') {
                document.getElementById('teacherStatsTab').style.display = 'block';
                document.getElementById('quickStatsBtn').style.display = 'block';
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ–∫—Ü–∏–∏
            const activeSection = document.querySelector('.section.active');
            if (activeSection) {
                await loadSectionData(activeSection.id);
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º dashboard
                await loadSectionData('dashboard');
            }
        } else {
            console.log('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', result.error);
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = 'login.html';
        }
    } catch (error) {
        console.error('‚ùå Auth error:', error);
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
    }
}

        function displayUserInfo() {
            document.getElementById('userName').textContent = currentUser.username;
        }

// ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–£–°–°–ö–û–ì–û –Ø–ó–´–ö–ê ====================

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ä—É—Å—Å–∫–∏–π
function getGradeTypeText(gradeType) {
    const types = {
        'exam': '–≠–∫–∑–∞–º–µ–Ω',
        'test': '–ó–∞—á—ë—Ç',
        'credit': '–î–∏—Ñ. –∑–∞—á—ë—Ç',
        'coursework': '–ö—É—Ä—Å–æ–≤–∞—è',
        'practice': '–ü—Ä–∞–∫—Ç–∏–∫–∞'
    };
    return types[gradeType] || gradeType || '–ù–µ —É–∫–∞–∑–∞–Ω';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –æ—Ü–µ–Ω–∫–∏/–∑–∞—á—ë—Ç–∞
function getGradeColor(grade, is_pass, grade_type) {
    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞—á—ë—Ç–æ–≤
    if (grade_type === 'test') {
        return is_pass ? 'success' : 'danger';
    }
    
    // –î–ª—è –¥–∏—Ñ–∑–∞—á—ë—Ç–æ–≤ –∏ –æ—Ü–µ–Ω–æ–∫
    if (grade >= 4) return 'success';
    if (grade === 3) return 'warning';
    return 'danger';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏/–∑–∞—á—ë—Ç–∞
function getGradeDisplay(grade, is_pass, grade_type) {
    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞—á—ë—Ç–æ–≤
    if (grade_type === 'test') {
        return is_pass ? '–ó–∞—á—ë—Ç' : '–ù–µ–∑–∞—á—ë—Ç';
    }
    
    // –î–ª—è –¥–∏—Ñ–∑–∞—á—ë—Ç–æ–≤ –∏ –æ—Ü–µ–Ω–æ–∫
    return grade || '‚Äî';
}

        async function loadGrades() {
    try {
        let url = '';
        let title = '';
        
        if (currentUser.role === 'student' && currentUser.student_id) {
            url = `/api/grades/student/${currentUser.student_id}`;
            title = '–ú–æ–∏ –æ—Ü–µ–Ω–∫–∏';
        } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
            url = `/api/grades/teacher/${currentUser.teacher_id}`;
            title = '–û—Ü–µ–Ω–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤';
        } else {
            document.getElementById('gradesList').innerHTML = `
                <div class="alert alert-info">
                    <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ü–µ–Ω–∫–∞—Ö</h5>
                    <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</p>
                </div>
            `;
            return;
        }

        const response = await fetch(url, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
            let html = '';
            
            // –î–õ–Ø –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–ï–ô - –î–û–ë–ê–í–õ–Ø–ï–ú –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô
            if (currentUser.role === 'teacher') {
                html = `
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h5 class="mb-0">${title}</h5>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="showAddGradeModal()">
                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
            </button>
            <button class="btn btn-success" onclick="showAddCreditModal()">
                <i class="bi bi-check-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞—á—ë—Ç
            </button>
            <button class="btn btn-info" onclick="showMassGrading()">
                <i class="bi bi-people"></i> –ú–∞—Å—Å–æ–≤–æ–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
            </button>
        </div>
    </div>
`;
            } else {
                html = `<h5 class="mb-4">${title}</h5>`;
            }
            
            html += `
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
            `;
            
            if (currentUser.role === 'student') {
                html += `
                    <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                    <th>–û—Ü–µ–Ω–∫–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                `;
            } else {
                html += `
                    <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                    <th>–ì—Ä—É–ø–ø–∞</th>
                    <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                    <th>–û—Ü–µ–Ω–∫–∞</th>
                    <th>–¢–∏–ø</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                `;
            }
            
            html += `</tr></thead><tbody>`;
            
            result.data.forEach(grade => {
                if (currentUser.role === 'student') {
                    html += `
                        <tr>
                            <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            <td>
                                <span class="badge bg-${getGradeColor(grade.grade, grade.is_pass, grade.grade_type)} fs-6">
    ${getGradeDisplay(grade.grade, grade.is_pass, grade.grade_type)}
</span>
                            </td>
                            <td>${getGradeTypeText(grade.grade_type)}</td>
                            <td>${new Date(grade.date).toLocaleDateString()}</td>
                            <td>${grade.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        </tr>
                    `;
                } else {
                    // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                    html += `
                        <tr>
                            <td>${grade.student_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            <td>${grade.group_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            <td>
                               <span class="badge bg-${getGradeColor(grade.grade, grade.is_pass, grade.grade_type)} fs-6">
    ${getGradeDisplay(grade.grade, grade.is_pass, grade.grade_type)}
</span>
                            </td>
                            <td>${getGradeTypeText(grade.grade_type)}</td>
                            <td>${new Date(grade.date).toLocaleDateString()}</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-warning" onclick="editGrade(${grade.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="deleteGrade(${grade.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            });
            
            html += `</tbody></table></div>`;
            document.getElementById('gradesList').innerHTML = html;
        } else {
            let noDataHtml = '';
            
            if (currentUser.role === 'teacher') {
                noDataHtml = `
                    <div class="text-center py-5">
                        <div class="mb-4">
                            <i class="bi bi-journal-check display-1 text-muted"></i>
                        </div>
                        <h5 class="text-muted mb-3">–û—Ü–µ–Ω–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</h5>
                        <p class="text-muted mb-4">–í—ã –µ—â–µ –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –æ—Ü–µ–Ω–∫–∏</p>
                        <div class="btn-group">
                            <button class="btn btn-primary" onclick="showAddGradeModal()">
                                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –æ—Ü–µ–Ω–∫—É
                            </button>
                            <button class="btn btn-success" onclick="showAddCreditModal()">
                                <i class="bi bi-check-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞—á—ë—Ç
                            </button>
                        </div>
                    </div>
                `;
            } else {
                noDataHtml = `
                    <div class="alert alert-warning">
                        <h5>–û—Ü–µ–Ω–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                        <p>${currentUser.role === 'student' ? '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫.' : '–í—ã –ø–æ–∫–∞ –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –æ—Ü–µ–Ω–∫–∏.'}</p>
                    </div>
                `;
            }
            
            document.getElementById('gradesList').innerHTML = noDataHtml;
        }
    } catch (error) {
        console.error('Error loading grades:', error);
        document.getElementById('gradesList').innerHTML = `
            <div class="alert alert-danger">
                <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –æ—Ü–µ–Ω–∫–∞—Ö.</p>
            </div>
        `;
    }
}

        async function loadSchedule() {
            try {
                let url = '';
                if (currentUser.role === 'student' && currentUser.student_id) {
                    url = `/api/schedule/student/${currentUser.student_id}`;
                } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    url = `/api/schedule/teacher/${currentUser.teacher_id}`;
                } else {
                    document.getElementById('scheduleList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h5>
                            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</p>
                        </div>
                    `;
                    return;
                }

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success && result.data.schedule && result.data.schedule.length > 0) {
                    const schedule = result.data.schedule;
                    let html = `
                        <h5 class="mb-4">–ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>–î–µ–Ω—å</th>
                                        <th>–í—Ä–µ–º—è</th>
                                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                        <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                        <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    const days = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
                    
                    schedule.forEach(item => {
                        html += `
                            <tr>
                                <td>${days[item.day_of_week - 1] || item.day_of_week}</td>
                                <td>${item.start_time} - ${item.end_time}</td>
                                <td>${item.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${item.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${item.classroom || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</td>
                            </tr>
                        `;
                    });
                    
                    html += `</tbody></table></div>`;
                    document.getElementById('scheduleList').innerHTML = html;
                } else {
                    document.getElementById('scheduleList').innerHTML = `
                        <div class="alert alert-warning">
                            <h5>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h5>
                            <p>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤–∞—Å –ø–æ–∫–∞ –Ω–µ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–æ.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading schedule:', error);
                document.getElementById('scheduleList').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.</p>
                    </div>
                `;
            }
        }

        async function loadAttendance() {
            try {
                if (currentUser.role === 'student' && currentUser.student_id) {
                    const response = await fetch(`/api/attendance/student/${currentUser.student_id}`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    const result = await response.json();
                    
                    if (result.success && result.data.attendance && result.data.attendance.length > 0) {
                        const attendance = result.data.attendance;
                        let html = `
                            <h5 class="mb-4">–ú–æ—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>–î–∞—Ç–∞</th>
                                            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        attendance.forEach(item => {
                            const statusBadge = item.status === 'present' ? 
                                '<span class="badge bg-success">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>' :
                                '<span class="badge bg-danger">–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>';
                            
                            html += `
                                <tr>
                                    <td>${new Date(item.date).toLocaleDateString()}</td>
                                    <td>${item.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                    <td>${statusBadge}</td>
                                    <td>${item.teacher_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                </tr>
                            `;
                        });
                        
                        html += `</tbody></table></div>`;
                        document.getElementById('attendanceList').innerHTML = html;
                    } else {
                        document.getElementById('attendanceList').innerHTML = `
                            <div class="alert alert-warning">
                                <h5>–î–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏.</p>
                            </div>
                        `;
                    }
                } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
                    document.getElementById('attendanceList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <p>–î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.</p>
                        </div>
                    `;
                } else {
                    document.getElementById('attendanceList').innerHTML = `
                        <div class="alert alert-info">
                            <h5>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                            <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading attendance:', error);
                document.getElementById('attendanceList').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏.</p>
                    </div>
                `;
            }
        }

        async function loadTeacherStatistics() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/statistics`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
                    document.getElementById('teacherStudentsCount').textContent = stats.students_count;
                    document.getElementById('teacherGradesCount').textContent = stats.grades_count;
                    document.getElementById('teacherAverageGrade').textContent = stats.average_grade;
                    document.getElementById('teacherSubjectsCount').textContent = stats.subjects_stats.length;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫
                    if (stats.grades_distribution && stats.grades_distribution.length > 0) {
                        let html = '';
                        const total = stats.grades_distribution.reduce((sum, d) => sum + d.count, 0);
                        
                        stats.grades_distribution.forEach(item => {
                            const percentage = total > 0 ? Math.round((item.count / total) * 100) : 0;
                            
                            html += `
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span>–û—Ü–µ–Ω–∫–∞ ${item.grade}</span>
                                    <div class="d-flex align-items-center gap-2">
                                        <div class="progress" style="width: 100px;">
                                            <div class="progress-bar bg-${item.grade >= 4 ? 'success' : item.grade >= 3 ? 'warning' : 'danger'}" 
                                                 style="width: ${percentage}%"></div>
                                        </div>
                                        <small class="text-muted">${item.count} (${percentage}%)</small>
                                    </div>
                                </div>
                            `;
                        });
                        document.getElementById('teacherGradesDistribution').innerHTML = html;
                    } else {
                        document.getElementById('teacherGradesDistribution').innerHTML = '<p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –æ—Ü–µ–Ω–æ–∫</p>';
                    }
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º
                    if (stats.subjects_stats && stats.subjects_stats.length > 0) {
                        let html = '';
                        stats.subjects_stats.forEach(subject => {
                            const avgGrade = subject.average_grade ? Math.round(subject.average_grade * 100) / 100 : 0;
                            const gradeCount = subject.grade_count || 0;
                            
                            html += `
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-truncate" style="max-width: 150px;" title="${subject.name}">
                                        ${subject.name}
                                    </span>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-primary">${avgGrade}</span>
                                        <small class="text-muted">(${gradeCount})</small>
                                    </div>
                                </div>
                            `;
                        });
                        document.getElementById('teacherSubjectsStats').innerHTML = html;
                    } else {
                        document.getElementById('teacherSubjectsStats').innerHTML = '<p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º</p>';
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
                    await loadTeacherRecentGrades();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Error loading teacher statistics:', error);
                document.getElementById('teacherStatisticsContent').innerHTML = `
                    <div class="alert alert-danger">
                        <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
                        <p class="small">${error.message}</p>
                    </div>
                `;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        async function loadTeacherRecentGrades() {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/recent-grades`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();
                
                if (result.success && result.data && result.data.length > 0) {
                    let html = `
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr>
                                        <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                        <th>–û—Ü–µ–Ω–∫–∞</th>
                                        <th>–î–∞—Ç–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    result.data.forEach(grade => {
                        html += `
                            <tr>
                                <td>${grade.student_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                                <td>
                                    <span class="badge bg-${getGradeColor(grade.grade, grade.is_pass, grade.grade_type)} fs-6">
    ${getGradeDisplay(grade.grade, grade.is_pass, grade.grade_type)}
</span>
                                </td>
                                <td>${new Date(grade.date).toLocaleDateString()}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('teacherRecentGrades').innerHTML = html;
                } else {
                    document.getElementById('teacherRecentGrades').innerHTML = 
                        '<p class="text-muted">–ù–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                }
            } catch (error) {
                console.error('Error loading recent grades:', error);
                document.getElementById('teacherRecentGrades').innerHTML = 
                    '<p class="text-muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        function refreshTeacherStatistics() {
            loadTeacherStatistics();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
async function loadDashboard() {
    try {
        const userInfoDiv = document.getElementById('userDetails');
        if (!userInfoDiv) {
            console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç userDetails –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }

        console.log('üîç –ó–∞–≥—Ä—É–∂–∞–µ–º dashboard –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUser);
        
        // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        let html = `
            <p class="mb-2"><strong>üë§ –õ–æ–≥–∏–Ω:</strong> ${currentUser.username}</p>
            <p class="mb-2"><strong>üéØ –†–æ–ª—å:</strong> <span class="${getRoleClass(currentUser.role)} role-badge">${getRoleText(currentUser.role)}</span></p>
        `;

        // –î–æ–±–∞–≤–ª—è–µ–º ID —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–ª–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
        if (currentUser.student_id) {
            html += `<p class="mb-2"><strong>üéì ID —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong> ${currentUser.student_id}</p>`;
        }
        if (currentUser.teacher_id) {
            html += `<p class="mb-0"><strong>üë®‚Äçüè´ ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</strong> ${currentUser.teacher_id}</p>`;
        }

        // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
        if (currentUser.role === 'student' && currentUser.student_id) {
            try {
                const response = await fetch(`/api/grades/student/${currentUser.student_id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    html += `
                        <div class="mt-3 pt-3 border-top">
                            <h6 class="mb-2">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏:</h6>
                            <div class="list-group list-group-flush">
                    `;
                    
                    result.data.slice(0, 5).forEach(grade => {
                        html += `
                            <div class="list-group-item d-flex justify-content-between align-items-center px-0 py-1">
                                <small>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</small>
                                <span class="badge bg-${getGradeColor(grade.grade, grade.is_pass, grade.grade_type)}">
                                    ${getGradeDisplay(grade.grade, grade.is_pass, grade.grade_type)}
                                </span>
                            </div>
                        `;
                    });
                    
                    html += `</div></div>`;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ü–µ–Ω–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–∞:', error);
                html += `
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-muted small">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ü–µ–Ω–∫–∞—Ö</p>
                    </div>
                `;
            }
        }
        
        // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±—ã—Å—Ç—Ä—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        if (currentUser.role === 'teacher' && currentUser.teacher_id) {
            try {
                const response = await fetch(`/api/teacher/${currentUser.teacher_id}/statistics`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    html += `
                        <div class="mt-3 pt-3 border-top">
                            <h6 class="mb-2">üìä –ë—ã—Å—Ç—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h6>
                            <div class="row small">
                                <div class="col-6">
                                    <strong>–°—Ç—É–¥–µ–Ω—Ç–æ–≤:</strong><br>
                                    <span class="text-primary">${stats.students_count || 0}</span>
                                </div>
                                <div class="col-6">
                                    <strong>–û—Ü–µ–Ω–æ–∫:</strong><br>
                                    <span class="text-primary">${stats.grades_count || 0}</span>
                                </div>
                                <div class="col-6 mt-2">
                                    <strong>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong><br>
                                    <span class="text-primary">${stats.average_grade || 0}</span>
                                </div>
                                <div class="col-6 mt-2">
                                    <strong>–ü—Ä–µ–¥–º–µ—Ç–æ–≤:</strong><br>
                                    <span class="text-primary">${stats.subjects_stats?.length || 0}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:', error);
                html += `
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-muted small">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</p>
                    </div>
                `;
            }
        }
        
        // –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        if (currentUser.role === 'admin') {
            try {
                const response = await fetch('/api/statistics/overview', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const result = await response.json();
                
                if (result.success) {
                    const stats = result.data;
                    html += `
                        <div class="mt-3 pt-3 border-top">
                            <h6 class="mb-2">üè¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã:</h6>
                            <div class="row small">
                                <div class="col-6">
                                    <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong><br>
                                    <span class="text-primary">${stats.users || 0}</span>
                                </div>
                                <div class="col-6">
                                    <strong>–°—Ç—É–¥–µ–Ω—Ç–æ–≤:</strong><br>
                                    <span class="text-primary">${stats.students || 0}</span>
                                </div>
                                <div class="col-6 mt-2">
                                    <strong>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:</strong><br>
                                    <span class="text-primary">${stats.teachers || 0}</span>
                                </div>
                                <div class="col-6 mt-2">
                                    <strong>–û—Ü–µ–Ω–æ–∫:</strong><br>
                                    <span class="text-primary">${stats.grades || 0}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                html += `
                    <div class="mt-3 pt-3 border-top">
                        <p class="text-muted small">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</p>
                    </div>
                `;
            }
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º HTML
        userInfoDiv.innerHTML = html;
        console.log('‚úÖ Dashboard –∑–∞–≥—Ä—É–∂–µ–Ω');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ dashboard:', error);
        // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        const userInfoDiv = document.getElementById('userDetails');
        if (userInfoDiv) {
            userInfoDiv.innerHTML = `
                <p class="mb-2"><strong>üë§ –õ–æ–≥–∏–Ω:</strong> ${currentUser.username}</p>
                <p class="mb-2"><strong>üéØ –†–æ–ª—å:</strong> <span class="${getRoleClass(currentUser.role)} role-badge">${getRoleText(currentUser.role)}</span></p>
                ${currentUser.student_id ? `<p class="mb-2"><strong>üéì ID —Å—Ç—É–¥–µ–Ω—Ç–∞:</strong> ${currentUser.student_id}</p>` : ''}
                ${currentUser.teacher_id ? `<p class="mb-0"><strong>üë®‚Äçüè´ ID –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</strong> ${currentUser.teacher_id}</p>` : ''}
                <div class="mt-3 pt-3 border-top">
                    <p class="text-muted small">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</p>
                </div>
            `;
        }
    }
}

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–æ–ª–µ–π
        function getRoleText(role) {
            switch(role) {
                case 'admin': return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                case 'teacher': return '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å';
                case 'student': return '–°—Ç—É–¥–µ–Ω—Ç';
                default: return role;
            }
        }

        function getRoleClass(role) {
            switch(role) {
                case 'admin': return 'role-admin';
                case 'teacher': return 'role-teacher';
                case 'student': return 'role-student';
                default: return '';
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        checkAuth();

        // ==================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –í–´–°–¢–ê–í–õ–ï–ù–ò–Ø –û–¶–ï–ù–û–ö ====================

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function showAddGradeModal() {
    try {
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('addGradeForm').reset();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
        await loadStudentsForModal('gradeStudentSelect');
        await loadSubjectsForModal('gradeSubjectSelectModal');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('gradeDate').valueAsDate = new Date();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Bootstrap
        const modalElement = document.getElementById('addGradeModal');
        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        } else {
            // Fallback –µ—Å–ª–∏ Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
            modalElement.style.display = 'block';
            modalElement.classList.add('show');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.');
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞—á—ë—Ç–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function showAddCreditModal() {
    try {
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('addCreditForm').reset();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
        await loadStudentsForModal('creditStudentSelect');
        await loadSubjectsForModal('creditSubjectSelect');
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('creditDate').valueAsDate = new Date();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π Bootstrap
        const modalElement = document.getElementById('addCreditModal');
        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        } else {
            // Fallback –µ—Å–ª–∏ Bootstrap –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
            modalElement.style.display = 'block';
            modalElement.classList.add('show');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function loadStudentsForModal(selectId) {
    try {
        const response = await fetch('/api/students', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const result = await response.json();
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞...</option>';
            
            if (result.success && Array.isArray(result.data)) {
                result.data.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.group_name || '–ë–µ–∑ –≥—Ä—É–ø–ø—ã'})`;
                    select.appendChild(option);
                });
            } else {
                // –ï—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                const testStudents = [
                    { id: 1, name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π", group_name: "–ò–¢-21" },
                    { id: 2, name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", group_name: "–ò–¢-21" },
                    { id: 3, name: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π", group_name: "–ü-22" }
                ];
                
                testStudents.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = `${student.name} (${student.group_name})`;
                    select.appendChild(option);
                });
            }
        } else {
            throw new Error('–û—à–∏–±–∫–∞ API');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:', error);
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        const select = document.getElementById(selectId);
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞...</option>';
        
        const testStudents = [
            { id: 1, name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π", group_name: "–ò–¢-21" },
            { id: 2, name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", group_name: "–ò–¢-21" },
            { id: 3, name: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π", group_name: "–ü-22" }
        ];
        
        testStudents.forEach(student => {
            const option = document.createElement('option');
            option.value = student.id;
            option.textContent = `${student.name} (${student.group_name})`;
            select.appendChild(option);
        });
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function loadSubjectsForModal(selectId) {
    try {
        const response = await fetch('/api/subjects', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const result = await response.json();
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
            
            if (result.success && Array.isArray(result.data)) {
                result.data.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    select.appendChild(option);
                });
            } else {
                // –ï—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
                const testSubjects = [
                    { id: 1, name: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python" },
                    { id: 2, name: "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö" },
                    { id: 3, name: "–í—ã—Å—à–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞" },
                    { id: 4, name: "–í–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" }
                ];
                
                testSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    select.appendChild(option);
                });
            }
        } else {
            throw new Error('–û—à–∏–±–∫–∞ API');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ
        const select = document.getElementById(selectId);
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
        
        const testSubjects = [
            { id: 1, name: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python" },
            { id: 2, name: "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö" },
            { id: 3, name: "–í—ã—Å—à–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞" },
            { id: 4, name: "–í–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" }
        ];
        
        testSubjects.forEach(subject => {
            const option = document.createElement('option');
            option.value = subject.id;
            option.textContent = subject.name;
            select.appendChild(option);
        });
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ü–µ–Ω–∫–∏
async function submitGrade() {
    const formData = {
        student_id: document.getElementById('gradeStudentSelect').value,
        subject_id: document.getElementById('gradeSubjectSelectModal').value,
        grade: parseInt(document.getElementById('gradeValueSelect').value),
        grade_type: document.getElementById('gradeTypeSelect').value,
        date: document.getElementById('gradeDate').value,
        notes: document.getElementById('gradeNotes').value
    };

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!formData.student_id || !formData.subject_id || !formData.grade || !formData.grade_type || !formData.date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }

    try {
        const response = await fetch('/api/grades', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = bootstrap.Modal.getInstance(document.getElementById('addGradeModal'));
            modal.hide();
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ü–µ–Ω–æ–∫
            await loadGrades();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏');
    }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—á—ë—Ç–∞ - –í–ï–†–°–ò–Ø –° –û–¢–õ–ê–î–ö–û–ô
async function submitCredit() {
    const creditType = document.getElementById('creditTypeSelect').value;
    
    console.log('üîç DEBUG - –¢–∏–ø –∑–∞—á—ë—Ç–∞:', creditType);
    
    let formData = {
        student_id: document.getElementById('creditStudentSelect').value,
        subject_id: document.getElementById('creditSubjectSelect').value,
        grade_type: creditType,
        date: document.getElementById('creditDate').value,
        notes: document.getElementById('creditNotes').value
    };

    console.log('üîç DEBUG - –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', formData);

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—â–∏—Ö –ø–æ–ª–µ–π
    if (!formData.student_id || !formData.subject_id || !formData.grade_type || !formData.date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        console.log('‚ùå –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞—á—ë—Ç–∞
    if (creditType === 'test') {
        // –û–±—ã—á–Ω—ã–π –∑–∞—á—ë—Ç
        const creditResult = document.querySelector('input[name="creditResult"]:checked');
        console.log('üîç DEBUG - –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—á—ë—Ç–∞:', creditResult);
        
        if (!creditResult) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—á—ë—Ç–∞');
            return;
        }
        formData.is_pass = parseInt(creditResult.value);
        console.log('üîç DEBUG - is_pass:', formData.is_pass);
    } else if (creditType === 'credit') {
        // –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç
        const grade = document.getElementById('diffGradeSelect').value;
        console.log('üîç DEBUG - –û—Ü–µ–Ω–∫–∞:', grade);
        
        if (!grade) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –¥–ª—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞—á—ë—Ç–∞');
            return;
        }
        formData.grade = parseInt(grade);
        console.log('üîç DEBUG - grade:', formData.grade);
    }

    console.log('üîç DEBUG - –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', formData);

    try {
        console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/grades/credit');
        const response = await fetch('/api/grades/credit', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
        
        if (result.success) {
            alert('‚úÖ –ó–∞—á—ë—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeAddCreditModal();
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ü–µ–Ω–æ–∫
            await loadGrades();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞—á—ë—Ç–∞:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞—á—ë—Ç–∞: ' + error.message);
    }
}

// –£–¥–∞–ª–∏—Ç—å –æ—Ü–µ–Ω–∫—É
async function deleteGrade(gradeId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –æ—Ü–µ–Ω–∫—É?')) {
        return;
    }

    try {
        const response = await fetch(`/api/grades/${gradeId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ü–µ–Ω–æ–∫
            await loadGrades();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏');
    }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ü–µ–Ω–∫—É (–∑–∞–≥–ª—É—à–∫–∞)
function editGrade(gradeId) {
    alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ ${gradeId} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ\n–ü–æ–∫–∞ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –æ—Ü–µ–Ω–∫—É.`);
}

// –§—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
function closeAddGradeModal() {
    const modalElement = document.getElementById('addGradeModal');
    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
        const modal = bootstrap.Modal.getInstance(modalElement);
        modal.hide();
    } else {
        modalElement.style.display = 'none';
        modalElement.classList.remove('show');
    }
}

function closeAddCreditModal() {
    const modalElement = document.getElementById('addCreditModal');
    if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
        const modal = bootstrap.Modal.getInstance(modalElement);
        modal.hide();
    } else {
        modalElement.style.display = 'none';
        modalElement.classList.remove('show');
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –∑–∞—á—ë—Ç–æ–≤
function toggleCreditType() {
    const creditType = document.getElementById('creditTypeSelect').value;
    const simpleBlock = document.getElementById('simpleCreditBlock');
    const diffBlock = document.getElementById('diffCreditBlock');
    
    if (creditType === 'test') {
        // –û–±—ã—á–Ω—ã–π –∑–∞—á—ë—Ç
        simpleBlock.style.display = 'block';
        diffBlock.style.display = 'none';
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –æ—Ü–µ–Ω–∫–∏
        document.getElementById('diffGradeSelect').value = '';
    } else if (creditType === 'credit') {
        // –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç
        simpleBlock.style.display = 'none';
        diffBlock.style.display = 'block';
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('input[name="creditResult"]').forEach(radio => {
            radio.checked = false;
        });
    } else {
        // –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ
        simpleBlock.style.display = 'none';
        diffBlock.style.display = 'none';
    }
}



// ==================== –§–£–ù–ö–¶–ò–ò –ú–ê–°–°–û–í–û–ì–û –í–´–°–¢–ê–í–õ–ï–ù–ò–Ø ====================

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
async function showMassGrading() {
    try {
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('massGradingTable').innerHTML = `
            <div class="alert alert-info">
                <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –∏ –ø—Ä–µ–¥–º–µ—Ç —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
            </div>
        `;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
        await loadGroupsForMassGrading();
        await loadSubjectsForMassGrading();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
        document.getElementById('massDate').valueAsDate = new Date();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = document.getElementById('massGradingModal');
        modal.style.display = 'flex';
        modal.classList.add('show');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–Ω–∏–π —Ñ–æ–Ω
        const backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop';
        backdrop.id = 'massGradingBackdrop';
        document.body.appendChild(backdrop);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è.');
    }
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
function closeMassGradingModal() {
    const modal = document.getElementById('massGradingModal');
    modal.style.display = 'none';
    modal.classList.remove('show');
    
    const backdrop = document.getElementById('massGradingBackdrop');
    if (backdrop) {
        backdrop.remove();
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
async function loadGroupsForMassGrading() {
    try {
        const response = await fetch('/api/groups', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const result = await response.json();
            const select = document.getElementById('massGroupSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>';
            
            if (result.success && Array.isArray(result.data)) {
                result.data.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.name} - ${group.specialization || '–û–±—â–∞—è'}`;
                    select.appendChild(option);
                });
            } else {
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const testGroups = [
                    { id: 1, name: "–ò–¢-21", specialization: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" },
                    { id: 2, name: "–ü-22", specialization: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ" }
                ];
                
                testGroups.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.name} - ${group.specialization}`;
                    select.appendChild(option);
                });
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
async function loadSubjectsForMassGrading() {
    try {
        const response = await fetch('/api/subjects', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const result = await response.json();
            const select = document.getElementById('massSubjectSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
            
            if (result.success && Array.isArray(result.data)) {
                result.data.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    select.appendChild(option);
                });
            } else {
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                const testSubjects = [
                    { id: 1, name: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python" },
                    { id: 2, name: "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö" },
                    { id: 3, name: "–í—ã—Å—à–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞" }
                ];
                
                testSubjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject.id;
                    option.textContent = subject.name;
                    select.appendChild(option);
                });
            }
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è - –° –ü–†–û–í–ï–†–ö–û–ô –¢–ò–ü–ê
async function loadStudentsForMassGrading() {
    const groupId = document.getElementById('massGroupSelect').value;
    const subjectId = document.getElementById('massSubjectSelect').value;
    const gradeType = document.getElementById('massGradeType').value;
    
    if (!groupId || !subjectId || !gradeType) {
        document.getElementById('massGradingTable').innerHTML = `
            <div class="alert alert-warning">
                <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã</p>
            </div>
        `;
        return;
    }
    
    console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã:', groupId, '–ø—Ä–µ–¥–º–µ—Ç:', subjectId, '—Ç–∏–ø:', gradeType);
    
    try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        document.getElementById('massGradingTable').innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...</p>
            </div>
        `;
        
        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å API
        const response = await fetch(`/api/gradebook/${groupId}/${subjectId}`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        if (response.ok) {
            const result = await response.json();
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç API:', result);
            
            if (result.success) {
                displayMassGradingTable(result.data, gradeType);
                return;
            }
        }
        
        // –ï—Å–ª–∏ API –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        console.log('‚ö†Ô∏è API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
        const testData = {
            group: `–ì—Ä—É–ø–ø–∞ ${groupId}`,
            subject: `–ü—Ä–µ–¥–º–µ—Ç ${subjectId}`,
            students: [
                {
                    student_id: 1,
                    student_name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π –°–µ—Ä–≥–µ–µ–≤–∏—á",
                    student_card: "–°–¢-001",
                    grade: null,
                    is_pass: null,
                    grade_type: null,
                    date: null
                },
                {
                    student_id: 2,
                    student_name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è –î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞",
                    student_card: "–°–¢-002", 
                    grade: 4,
                    is_pass: null,
                    grade_type: "exam",
                    date: "2024-01-15"
                },
                {
                    student_id: 3,
                    student_name: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π –ò–≤–∞–Ω–æ–≤–∏—á",
                    student_card: "–°–¢-003",
                    grade: null,
                    is_pass: 1,
                    grade_type: "test",
                    date: "2024-01-10"
                },
                {
                    student_id: 4, 
                    student_name: "–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–Ω–∞",
                    student_card: "–°–¢-004",
                    grade: 5,
                    is_pass: null,
                    grade_type: "credit",
                    date: "2024-01-12"
                }
            ]
        };
        
        displayMassGradingTable(testData, gradeType);
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:', error);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        const testData = {
            group: "–ò–¢-21",
            subject: "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
            students: [
                {
                    student_id: 1,
                    student_name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π",
                    student_card: "–°–¢-001",
                    grade: null,
                    is_pass: null,
                    grade_type: null
                },
                {
                    student_id: 2,
                    student_name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è", 
                    student_card: "–°–¢-002",
                    grade: 4,
                    is_pass: null,
                    grade_type: "exam"
                }
            ]
        };
        
        displayMassGradingTable(testData, gradeType);
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è - –° –û–¢–õ–ê–î–ö–û–ô
function displayMassGradingTable(data, gradeType) {
    const tableDiv = document.getElementById('massGradingTable');
    
    console.log('üîç –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:', data);
    console.log('üîç –¢–∏–ø –æ—Ü–µ–Ω–∫–∏:', gradeType);
    
    if (!data || !data.students || !Array.isArray(data.students)) {
        tableDiv.innerHTML = `
            <div class="alert alert-danger">
                <p class="mb-0">–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
            </div>
        `;
        return;
    }
    
    let html = `
        <h6>–°—Ç—É–¥–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã "${data.group || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞'}" - "${data.subject || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç'}"</h6>
        <div class="alert alert-info">
            <small>–°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${data.students.length}</small>
        </div>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                        <th>–ó–∞—á—ë—Ç–∫–∞</th>
                        <th>–¢–µ–∫—É—â–∞—è –æ—Ü–µ–Ω–∫–∞</th>
                        <th>–ù–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    data.students.forEach(student => {
        const currentGrade = student.grade || (student.is_pass !== undefined ? (student.is_pass ? '–ó–∞—á—ë—Ç' : '–ù–µ–∑–∞—á—ë—Ç') : '‚Äî');
        const currentGradeType = student.grade_type ? getGradeTypeText(student.grade_type) : '‚Äî';
        
        let inputField = '';
        if (gradeType === 'test') {
            // –ó–∞—á—ë—Ç (–∑–∞—á—ë—Ç/–Ω–µ–∑–∞—á—ë—Ç)
            inputField = `
                <select class="form-select form-select-sm mass-grade-input" data-student-id="${student.student_id}">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                    <option value="1">–ó–∞—á—ë—Ç</option>
                    <option value="0">–ù–µ–∑–∞—á—ë—Ç</option>
                </select>
            `;
        } else {
            // –û—Ü–µ–Ω–∫–∞ (2-5)
            inputField = `
                <select class="form-select form-select-sm mass-grade-input" data-student-id="${student.student_id}">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                    <option value="5">5 (–û—Ç–ª–∏—á–Ω–æ)</option>
                    <option value="4">4 (–•–æ—Ä–æ—à–æ)</option>
                    <option value="3">3 (–£–¥–æ–≤–ª.)</option>
                    <option value="2">2 (–ù–µ—É–¥–æ–≤–ª.)</option>
                </select>
            `;
        }
        
        html += `
            <tr>
                <td>${student.student_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç'}</td>
                <td>${student.student_card || '‚Äî'}</td>
                <td>
                    <span class="badge bg-${getGradeColor(student.grade, student.is_pass, student.grade_type)}">
                        ${currentGrade}
                    </span>
                    ${currentGradeType !== '‚Äî' ? `<br><small>${currentGradeType}</small>` : ''}
                </td>
                <td style="width: 150px;">
                    ${inputField}
                </td>
                <td style="width: 200px;">
                    <input type="text" class="form-control form-control-sm mass-notes-input" 
                           data-student-id="${student.student_id}" placeholder="–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è...">
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    tableDiv.innerHTML = html;
    
    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞');
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –º–∞—Å—Å–æ–≤—ã—Ö –æ—Ü–µ–Ω–æ–∫ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function submitMassGrading() {
    const groupId = document.getElementById('massGroupSelect').value;
    const subjectId = document.getElementById('massSubjectSelect').value;
    const gradeType = document.getElementById('massGradeType').value;
    const date = document.getElementById('massDate').value;
    const commonNotes = document.getElementById('massNotes').value;
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!groupId || !subjectId || !gradeType || !date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    console.log('üîç –ù–∞—á–∏–Ω–∞–µ–º –º–∞—Å—Å–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...');
    console.log('üîç –¢–∏–ø —Ä–∞–±–æ—Ç—ã:', gradeType);
    console.log('üîç –î–∞—Ç–∞:', date);
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    const gradeInputs = document.querySelectorAll('.mass-grade-input');
    const gradesData = [];
    
    let hasGrades = false;
    
    gradeInputs.forEach(input => {
        const studentId = input.getAttribute('data-student-id');
        const gradeValue = input.value;
        
        console.log('üîç –°—Ç—É–¥–µ–Ω—Ç:', studentId, '–û—Ü–µ–Ω–∫–∞:', gradeValue);
        
        if (gradeValue) {
            hasGrades = true;
            const notesInput = document.querySelector(`.mass-notes-input[data-student-id="${studentId}"]`);
            const individualNotes = notesInput ? notesInput.value : '';
            
            const gradeData = {
                student_id: parseInt(studentId),
                subject_id: parseInt(subjectId),
                grade_type: gradeType,
                date: date,
                notes: individualNotes || commonNotes || ''
            };
            
            console.log('üîç –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞:', gradeData);
            
            if (gradeType === 'test') {
                // –î–ª—è –∑–∞—á—ë—Ç–æ–≤ - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º
                const isPassValue = parseInt(gradeValue);
                if (isPassValue === 0 || isPassValue === 1) {
                    gradeData.is_pass = isPassValue;
                    console.log('‚úÖ –ó–∞—á—ë—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', gradeData.is_pass);
                } else {
                    console.error('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—á—ë—Ç–∞:', gradeValue);
                    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                }
            } else {
                // –î–ª—è –æ—Ü–µ–Ω–æ–∫
                const gradeValueNum = parseInt(gradeValue);
                if (gradeValueNum >= 2 && gradeValueNum <= 5) {
                    gradeData.grade = gradeValueNum;
                    console.log('‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', gradeData.grade);
                } else {
                    console.error('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏:', gradeValue);
                    return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                }
            }
            
            gradesData.push(gradeData);
        }
    });
    
    if (!hasGrades) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã—Å—Ç–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ—Ü–µ–Ω–∫—É');
        return;
    }
    
    console.log('üìä –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', gradesData.length);
    console.log('üìã –î–∞–Ω–Ω—ã–µ:', gradesData);
    
    if (gradesData.length === 0) {
        alert('–ù–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        return;
    }
    
    try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        const saveBtn = document.querySelector('#massGradingModal .btn-success');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        saveBtn.disabled = true;
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏ –ø–æ –æ–¥–Ω–æ–π
        let successCount = 0;
        let errorCount = 0;
        let errors = [];
        
        for (const gradeData of gradesData) {
            try {
                console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', gradeData);
                
                // –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –æ—Ü–µ–Ω–æ–∫ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
                const url = '/api/grades';
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gradeData)
                });
                
                const result = await response.json();
                console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                
                if (result.success) {
                    successCount++;
                    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞:', gradeData.student_id);
                } else {
                    errorCount++;
                    errors.push(`–°—Ç—É–¥–µ–Ω—Ç ${gradeData.student_id}: ${result.error}`);
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result.error);
                }
            } catch (error) {
                errorCount++;
                errors.push(`–°—Ç—É–¥–µ–Ω—Ç ${gradeData.student_id}: ${error.message}`);
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        let message = `‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${successCount} –æ—Ü–µ–Ω–æ–∫`;
        if (errorCount > 0) {
            message += `\n‚ùå –û—à–∏–±–æ–∫: ${errorCount}`;
            message += `\n\n–û—à–∏–±–∫–∏:\n${errors.slice(0, 3).join('\n')}`;
            if (errors.length > 3) {
                message += `\n... –∏ –µ—â–µ ${errors.length - 3} –æ—à–∏–±–æ–∫`;
            }
        }
        
        alert(message);
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        closeMassGradingModal();
        await loadGrades();
        
    } catch (error) {
        console.error('‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫: ' + error.message);
    } finally {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        const saveBtn = document.querySelector('#massGradingModal .btn-success');
        if (saveBtn) {
            saveBtn.innerHTML = '<i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏';
            saveBtn.disabled = false;
        }
    }
}

// ==================== –ù–û–í–´–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –û–¶–ï–ù–ö–ê–ú–ò ====================

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è
async function loadCurrentGrades() {
    try {
        if (!currentUser.teacher_id) {
            document.getElementById('currentGradesList').innerHTML = `
                <div class="alert alert-warning">
                    <p>–§—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p>
                </div>
            `;
            return;
        }

        const response = await fetch(`/api/grades/teacher/${currentUser.teacher_id}`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
            let html = `
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                                <th>–ì—Ä—É–ø–ø–∞</th>
                                <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                                <th>–û—Ü–µ–Ω–∫–∞</th>
                                <th>–¢–∏–ø</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            result.data.forEach(grade => {
                html += `
                    <tr>
                        <td>${grade.student_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td>${grade.group_name || '‚Äî'}</td>
                        <td>${grade.subject_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                        <td>
                            <span class="badge bg-${getGradeColor(grade.grade, grade.is_pass, grade.grade_type)} fs-6">
                                ${getGradeDisplay(grade.grade, grade.is_pass, grade.grade_type)}
                            </span>
                        </td>
                        <td>${getGradeTypeText(grade.grade_type)}</td>
                        <td>${new Date(grade.date).toLocaleDateString()}</td>
                        <td>
    <div class="btn-group btn-group-sm">
        <button class="btn btn-outline-warning" onclick="editGrade(${grade.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
            <i class="bi bi-pencil"></i>
        </button>
        <button class="btn btn-outline-danger" onclick="deleteGrade(${grade.id})" title="–£–¥–∞–ª–∏—Ç—å">
            <i class="bi bi-trash"></i>
        </button>
    </div>
</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            document.getElementById('currentGradesList').innerHTML = html;
        } else {
            document.getElementById('currentGradesList').innerHTML = `
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-journal-x display-1 text-muted"></i>
                    </div>
                    <h5 class="text-muted">–û—Ü–µ–Ω–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</h5>
                    <p class="text-muted">–í—ã –µ—â–µ –Ω–µ –ø–æ—Å—Ç–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–π –æ—Ü–µ–Ω–∫–∏</p>
                    <button class="btn btn-primary" onclick="switchToAddGradesTab()">
                        <i class="bi bi-plus-circle"></i> –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –æ—Ü–µ–Ω–∫—É
                    </button>
                </div>
            `;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫:', error);
        document.getElementById('currentGradesList').innerHTML = `
            <div class="alert alert-danger">
                <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–± –æ—Ü–µ–Ω–∫–∞—Ö.</p>
            </div>
        `;
    }
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
function switchToAddGradesTab() {
    const addGradesTab = document.getElementById('add-grades-tab');
    const currentGradesTab = document.getElementById('current-grades-tab');
    
    if (addGradesTab && currentGradesTab) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
        currentGradesTab.classList.remove('active');
        currentGradesTab.setAttribute('aria-selected', 'false');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ —Ü–µ–ª–µ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
        addGradesTab.classList.add('active');
        addGradesTab.setAttribute('aria-selected', 'true');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        document.getElementById('current-grades').classList.remove('show', 'active');
        document.getElementById('add-grades').classList.add('show', 'active');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
        initializeGradingTab();
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
async function initializeGradingTab() {
    await loadGradingGroups();
    await loadGradingSubjects();
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('gradingDate').value = today;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
async function loadGradingGroups() {
    try {
        const response = await fetch('/api/groups', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('gradingGroupSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = `${group.name} - ${group.specialization || '–û–±—â–∞—è'}`;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
async function loadGradingSubjects() {
    try {
        const response = await fetch('/api/subjects', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('gradingSubjectSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = subject.name;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã
function updateGradingInterface() {
    // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ü–µ–Ω–∫–∏
    console.log('–¢–∏–ø —Ä–∞–±–æ—Ç—ã –∏–∑–º–µ–Ω–µ–Ω:', document.getElementById('gradingTypeSelect').value);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
async function loadStudentsForGrading() {
    const groupId = document.getElementById('gradingGroupSelect').value;
    const subjectId = document.getElementById('gradingSubjectSelect').value;
    const gradeType = document.getElementById('gradingTypeSelect').value;
    
    console.log('üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏:', { groupId, subjectId, gradeType });
    
    if (!groupId || !subjectId || !gradeType) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ —Ç–∏–ø —Ä–∞–±–æ—Ç—ã');
        return;
    }

    try {
        document.getElementById('gradingStudentsList').innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...</p>
            </div>
        `;

        console.log('üöÄ –ó–∞–ø—Ä–æ—Å –∫ API: ', `/api/students/group/${groupId}`);
        
        const response = await fetch(`/api/students/group/${groupId}`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('üìä –î–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞:', result);
        
        if (result.success && result.data.length > 0) {
            console.log('‚úÖ –°—Ç—É–¥–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', result.data.length);
            displayGradingStudentsList(result.data, subjectId, gradeType);
        } else {
            console.log('‚ö†Ô∏è –ù–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏–ª–∏ –æ—à–∏–±–∫–∞');
            document.getElementById('gradingStudentsList').innerHTML = `
                <div class="alert alert-warning">
                    <p>–í –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                    <small class="text-muted">–ò–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ</small>
                </div>
            `;
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:', error);
        document.getElementById('gradingStudentsList').innerHTML = `
            <div class="alert alert-danger">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                <small class="text-muted">${error.message}</small>
            </div>
        `;
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
function displayGradingStudentsList(students, subjectId, gradeType) {
    let html = `
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                        <th>–ó–∞—á—ë—Ç–∫–∞</th>
                        <th>–û—Ü–µ–Ω–∫–∞</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    students.forEach(student => {
        const gradeInput = createGradeInput(gradeType, student.id);
        
        html += `
            <tr>
                <td>${student.name}</td>
                <td>${student.student_card || '‚Äî'}</td>
                <td style="width: 200px;">${gradeInput}</td>
                <td style="width: 250px;">
                    <input type="text" class="form-control form-control-sm student-notes" 
                           data-student-id="${student.id}" placeholder="–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è...">
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    document.getElementById('gradingStudentsList').innerHTML = html;
}

// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ –æ—Ü–µ–Ω–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
function createGradeInput(gradeType, studentId) {
    switch(gradeType) {
        case 'test': // –ó–∞—á—ë—Ç (–∑–∞—á—ë—Ç/–Ω–µ–∑–∞—á—ë—Ç)
            return `
                <select class="form-select form-select-sm grade-input" data-student-id="${studentId}">
                    <option value="">‚Äî</option>
                    <option value="1">–ó–∞—á—ë—Ç</option>
                    <option value="0">–ù–µ–∑–∞—á—ë—Ç</option>
                </select>
            `;
            
        case 'credit': // –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç (–æ—Ü–µ–Ω–∫–∞)
        case 'exam': // –≠–∫–∑–∞–º–µ–Ω (–æ—Ü–µ–Ω–∫–∞)
        case 'coursework': // –ö—É—Ä—Å–æ–≤–∞—è (–æ—Ü–µ–Ω–∫–∞)
        case 'practice': // –ü—Ä–∞–∫—Ç–∏–∫–∞ (–æ—Ü–µ–Ω–∫–∞)
            return `
                <select class="form-select form-select-sm grade-input" data-student-id="${studentId}">
                    <option value="">‚Äî</option>
                    <option value="5">5 (–û—Ç–ª–∏—á–Ω–æ)</option>
                    <option value="4">4 (–•–æ—Ä–æ—à–æ)</option>
                    <option value="3">3 (–£–¥–æ–≤–ª.)</option>
                    <option value="2">2 (–ù–µ—É–¥–æ–≤–ª.)</option>
                </select>
            `;
            
        default:
            return '<span class="text-muted">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø</span>';
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ü–µ–Ω–æ–∫ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function submitAllGrades() {
    const groupId = document.getElementById('gradingGroupSelect').value;
    const subjectId = document.getElementById('gradingSubjectSelect').value;
    const gradeType = document.getElementById('gradingTypeSelect').value;
    const date = document.getElementById('gradingDate').value;
    const commonNotes = document.getElementById('gradingCommonNotes').value;
    
    console.log('üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', { groupId, subjectId, gradeType, date, commonNotes });
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!groupId || !subjectId || !gradeType || !date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const gradeInputs = document.querySelectorAll('.grade-input');
    const gradesData = [];
    
    console.log('üîç –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞:', gradeInputs.length);
    
    gradeInputs.forEach(input => {
        const studentId = input.getAttribute('data-student-id');
        const gradeValue = input.value;
        
        console.log('üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞:', studentId, '–∑–Ω–∞—á–µ–Ω–∏–µ:', gradeValue);
        
        if (gradeValue) {
            const notesInput = document.querySelector(`.student-notes[data-student-id="${studentId}"]`);
            const individualNotes = notesInput ? notesInput.value : '';
            
            const gradeData = {
                student_id: parseInt(studentId),
                subject_id: parseInt(subjectId),
                grade_type: gradeType,
                date: date,
                notes: individualNotes || commonNotes || ''
            };
            
            console.log('üîç –î–∞–Ω–Ω—ã–µ –¥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:', gradeData);
            
            if (gradeType === 'test') {
                // –î–ª—è –∑–∞—á—ë—Ç–æ–≤
                gradeData.is_pass = parseInt(gradeValue);
                console.log('‚úÖ –ó–∞—á—ë—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', gradeData.is_pass);
            } else {
                // –î–ª—è –æ—Ü–µ–Ω–æ–∫ –∏ –¥–∏—Ñ–∑–∞—á—ë—Ç–æ–≤
                gradeData.grade = parseInt(gradeValue);
                console.log('‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞:', gradeData.grade);
            }
            
            gradesData.push(gradeData);
            console.log('üìù –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–∞:', gradeData);
        }
    });
    
    console.log('üìä –í—Å–µ–≥–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', gradesData.length);
    console.log('üìã –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', gradesData);
    
    if (gradesData.length === 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã—Å—Ç–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ—Ü–µ–Ω–∫—É');
        return;
    }
    
    try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        const saveBtn = document.querySelector('#add-grades .btn-success');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
        saveBtn.disabled = true;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ü–µ–Ω–∫–∏
        let successCount = 0;
        let errorCount = 0;
        let errors = [];
        
        for (const gradeData of gradesData) {
            try {
                console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', gradeData);
                
                // –í–ê–õ–ò–î–ê–¶–ò–Ø –î–ê–ù–ù–´–•
                const validationErrors = validateGradeData(gradeData);
                if (validationErrors.length > 0) {
                    errorCount++;
                    const errorMsg = `–°—Ç—É–¥–µ–Ω—Ç ${gradeData.student_id}: ${validationErrors.join(', ')}`;
                    errors.push(errorMsg);
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', errorMsg);
                    continue;
                }
                
                // –í–´–ë–ò–†–ê–ï–ú –ü–†–ê–í–ò–õ–¨–ù–´–ô URL
                let url = '/api/grades';
                if (gradeData.grade_type === 'test' || gradeData.grade_type === 'credit') {
                    url = '/api/grades/credit';
                    console.log('üìù –ò—Å–ø–æ–ª—å–∑—É–µ–º endpoint –¥–ª—è –∑–∞—á—ë—Ç–æ–≤');
                } else {
                    console.log('üìù –ò—Å–ø–æ–ª—å–∑—É–µ–º endpoint –¥–ª—è –æ—Ü–µ–Ω–æ–∫');
                }
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(gradeData)
                });
                
                console.log('üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
                
                const result = await response.json();
                console.log('üìä –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
                
                if (result.success) {
                    successCount++;
                    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞:', gradeData.student_id);
                } else {
                    errorCount++;
                    const errorMsg = `–°—Ç—É–¥–µ–Ω—Ç ${gradeData.student_id}: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                    errors.push(errorMsg);
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', errorMsg);
                }
            } catch (error) {
                errorCount++;
                const errorMsg = `–°—Ç—É–¥–µ–Ω—Ç ${gradeData.student_id}: ${error.message}`;
                errors.push(errorMsg);
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        let message = `‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${successCount} –æ—Ü–µ–Ω–æ–∫`;
        if (errorCount > 0) {
            message += `\n‚ùå –û—à–∏–±–æ–∫: ${errorCount}`;
            if (errors.length > 0) {
                message += `\n\n–û—à–∏–±–∫–∏:\n${errors.slice(0, 3).join('\n')}`;
                if (errors.length > 3) {
                    message += `\n... –∏ –µ—â–µ ${errors.length - 3} –æ—à–∏–±–æ–∫`;
                }
            }
        }
        
        alert(message);
        
        // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —É—Å–ø–µ—à–Ω–æ
        if (errorCount === 0) {
            document.getElementById('gradingStudentsList').innerHTML = `
                <div class="alert alert-success">
                    <p>‚úÖ –û—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –ú–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –æ—Ü–µ–Ω–∫–∏.</p>
                </div>
            `;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞
            document.querySelectorAll('.grade-input').forEach(input => {
                input.value = '';
            });
            document.querySelectorAll('.student-notes').forEach(input => {
                input.value = '';
            });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫
        await loadCurrentGrades();
        
    } catch (error) {
        console.error('‚ùå –û–±—â–∞—è –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫: ' + error.message);
    } finally {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        const saveBtn = document.querySelector('#add-grades .btn-success');
        if (saveBtn) {
            saveBtn.innerHTML = '<i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ';
            saveBtn.disabled = false;
        }
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫
function refreshCurrentGrades() {
    loadCurrentGrades();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –æ—Ü–µ–Ω–æ–∫
function initGradesTabs() {
    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const currentGradesTab = document.getElementById('current-grades-tab');
    const addGradesTab = document.getElementById('add-grades-tab');
    
    if (currentGradesTab && addGradesTab) {
        // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞
        currentGradesTab.classList.add('active');
        currentGradesTab.setAttribute('aria-selected', 'true');
        addGradesTab.classList.remove('active');
        addGradesTab.setAttribute('aria-selected', 'false');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
        document.getElementById('current-grades').classList.add('show', 'active');
        document.getElementById('add-grades').classList.remove('show', 'active');
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
document.addEventListener('DOMContentLoaded', function() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    initGradesTabs();
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
    const currentGradesTab = document.getElementById('current-grades-tab');
    const addGradesTab = document.getElementById('add-grades-tab');
    
    if (currentGradesTab) {
        currentGradesTab.addEventListener('click', function() {
            console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ç–µ–∫—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫');
            loadCurrentGrades();
        });
    }
    
    if (addGradesTab) {
        addGradesTab.addEventListener('click', function() {
            console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫');
            initializeGradingTab();
        });
    }
});

// –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
function validateGradeData(gradeData) {
    const errors = [];
    
    if (!gradeData.student_id) errors.push('–ù–µ —É–∫–∞–∑–∞–Ω student_id');
    if (!gradeData.subject_id) errors.push('–ù–µ —É–∫–∞–∑–∞–Ω subject_id');
    if (!gradeData.grade_type) errors.push('–ù–µ —É–∫–∞–∑–∞–Ω grade_type');
    if (!gradeData.date) errors.push('–ù–µ —É–∫–∞–∑–∞–Ω–∞ date');
    
    if (gradeData.grade_type === 'test') {
        if (gradeData.is_pass === undefined || gradeData.is_pass === null) {
            errors.push('–î–ª—è –∑–∞—á—ë—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω is_pass');
        } else if (gradeData.is_pass !== 0 && gradeData.is_pass !== 1) {
            errors.push('is_pass –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0 –∏–ª–∏ 1');
        }
    } else if (gradeData.grade_type === 'credit') {
        if (!gradeData.grade) {
            errors.push('–î–ª—è –¥–∏—Ñ–∑–∞—á—ë—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –æ—Ü–µ–Ω–∫–∞');
        } else if (gradeData.grade < 2 || gradeData.grade > 5) {
            errors.push('–û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 2 –¥–æ 5');
        }
    } else {
        // –î–ª—è –æ–±—ã—á–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫
        if (!gradeData.grade) {
            errors.push('–ù–µ —É–∫–∞–∑–∞–Ω–∞ –æ—Ü–µ–Ω–∫–∞');
        } else if (gradeData.grade < 2 || gradeData.grade > 5) {
            errors.push('–û—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 2 –¥–æ 5');
        }
    }
    
    return errors;
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ü–µ–Ω–∫—É
async function editGrade(gradeId) {
    try {
        console.log('üîç –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏:', gradeId);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏
        const response = await fetch(`/api/grades/${gradeId}`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success && result.data) {
            const grade = result.data;
            console.log('üìä –î–∞–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏:', grade);
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏
            document.getElementById('editGradeId').value = grade.id;
            document.getElementById('editStudentName').value = grade.student_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç';
            document.getElementById('editSubjectName').value = grade.subject_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç';
            document.getElementById('editGradeType').value = getGradeTypeText(grade.grade_type);
            document.getElementById('editGradeDate').value = grade.date;
            document.getElementById('editGradeNotes').value = grade.notes || '';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–∞–±–æ—Ç—ã
            const gradeBlock = document.getElementById('editGradeBlock');
            const creditBlock = document.getElementById('editCreditBlock');
            
            if (grade.grade_type === 'test') {
                // –ó–∞—á—ë—Ç
                gradeBlock.style.display = 'none';
                creditBlock.style.display = 'block';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—á—ë—Ç–∞
                if (grade.is_pass === 1) {
                    document.getElementById('editCreditPass').checked = true;
                } else {
                    document.getElementById('editCreditFail').checked = true;
                }
            } else {
                // –û—Ü–µ–Ω–∫–∞ –∏–ª–∏ –¥–∏—Ñ–∑–∞—á—ë—Ç
                gradeBlock.style.display = 'block';
                creditBlock.style.display = 'none';
                document.getElementById('editGradeValue').value = grade.grade || '';
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = new bootstrap.Modal(document.getElementById('editGradeModal'));
            modal.show();
            
        } else {
            alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏');
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ü–µ–Ω–∫–∏:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–∫–∏');
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
async function updateGrade() {
    const gradeId = document.getElementById('editGradeId').value;
    const date = document.getElementById('editGradeDate').value;
    const notes = document.getElementById('editGradeNotes').value;
    
    if (!date) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É');
        return;
    }
    
    try {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—Ü–µ–Ω–∫–∏ –∏ —Å–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        let updateData = {
            date: date,
            notes: notes
        };
        
        const gradeBlock = document.getElementById('editGradeBlock');
        const creditBlock = document.getElementById('editCreditBlock');
        
        if (gradeBlock.style.display !== 'none') {
            // –≠—Ç–æ –æ—Ü–µ–Ω–∫–∞ –∏–ª–∏ –¥–∏—Ñ–∑–∞—á—ë—Ç
            const gradeValue = document.getElementById('editGradeValue').value;
            if (!gradeValue) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –æ—Ü–µ–Ω–∫—É');
                return;
            }
            updateData.grade = parseInt(gradeValue);
        } else if (creditBlock.style.display !== 'none') {
            // –≠—Ç–æ –∑–∞—á—ë—Ç
            const creditResult = document.querySelector('input[name="editCreditResult"]:checked');
            if (!creditResult) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞—á—ë—Ç–∞');
                return;
            }
            updateData.is_pass = parseInt(creditResult.value);
        }
        
        console.log('üîç –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', updateData);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        const response = await fetch(`/api/grades/${gradeId}`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updateData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ –û—Ü–µ–Ω–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
            closeEditGradeModal();
            await loadCurrentGrades(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏');
    }
}

// ==================== –§–£–ù–ö–¶–ò–ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø –°–ï–°–°–ò–ò ====================

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
async function loadSessionSchedule() {
    try {
        let url = '';
        let userType = '';
        
        if (currentUser.role === 'student' && currentUser.student_id) {
            url = `/api/session-schedule/student/${currentUser.student_id}`;
            userType = 'student';
        } else if (currentUser.role === 'teacher' && currentUser.teacher_id) {
            url = `/api/session-schedule/teacher/${currentUser.teacher_id}`;
            userType = 'teacher';
        } else if (currentUser.role === 'admin') {
            url = '/api/session-schedule';
            userType = 'admin';
        } else {
            document.getElementById('sessionScheduleList').innerHTML = `
                <div class="alert alert-info">
                    <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.</p>
                </div>
            `;
            return;
        }

        console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏ –¥–ª—è:', userType, 'URL:', url);

        const response = await fetch(url, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
            displaySessionSchedule(result.data, userType);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            if (userType === 'student') {
                document.getElementById('studentScheduleHeader').style.display = 'block';
                document.getElementById('scheduleControls').style.display = 'none';
            } else {
                document.getElementById('studentScheduleHeader').style.display = 'none';
                document.getElementById('scheduleControls').style.display = 'block';
            }
        } else {
            document.getElementById('sessionScheduleList').innerHTML = `
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-calendar-x display-1 text-muted"></i>
                    </div>
                    <h5 class="text-muted">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø—É—Å—Ç–æ</h5>
                    <p class="text-muted">${userType === 'student' ? '–î–ª—è –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π —Å–µ—Å—Å–∏–∏.' : '–°–æ–±—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.'}</p>
                    ${userType !== 'student' ? `
                        <button class="btn btn-primary mt-2" onclick="showAddSessionEventModal()">
                            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
                        </button>
                    ` : ''}
                </div>
            `;
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏:', error);
        document.getElementById('sessionScheduleList').innerHTML = `
            <div class="alert alert-danger">
                <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏.</p>
            </div>
        `;
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
function displaySessionSchedule(schedule, userType) {
    let html = `
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                        <th>–¢–∏–ø</th>
                        <th>–ì—Ä—É–ø–ø–∞</th>
                        <th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th>
                        ${userType !== 'student' ? '<th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>' : ''}
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                        ${userType !== 'student' ? '<th>–î–µ–π—Å—Ç–≤–∏—è</th>' : ''}
                    </tr>
                </thead>
                <tbody>
    `;
    
    schedule.forEach(event => {
        const eventTypeText = getSessionEventTypeText(event.event_type);
        const eventTypeBadge = getSessionEventTypeBadge(event.event_type);
        const eventDate = new Date(event.event_date).toLocaleDateString();
        
        html += `
            <tr>
                <td><strong>${eventDate}</strong></td>
                <td>${event.start_time} - ${event.end_time}</td>
                <td>${event.subject_name}</td>
                <td>${eventTypeBadge}</td>
                <td>${event.group_name}</td>
                <td>${event.classroom || '‚Äî'}</td>
                ${userType !== 'student' ? `<td>${event.teacher_name}</td>` : ''}
                <td>${event.notes || '‚Äî'}</td>
                ${userType !== 'student' ? `
                    <td>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-warning" onclick="editSessionEvent(${event.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteSessionEvent(${event.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </td>
                ` : ''}
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    document.getElementById('sessionScheduleList').innerHTML = html;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
function getSessionEventTypeText(eventType) {
    const types = {
        'exam': '–≠–∫–∑–∞–º–µ–Ω',
        'test': '–ó–∞—á—ë—Ç',
        'credit': '–î–∏—Ñ. –∑–∞—á—ë—Ç',
        'consultation': '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'
    };
    return types[eventType] || eventType;
}

function getSessionEventTypeBadge(eventType) {
    const badges = {
        'exam': '<span class="badge bg-danger">–≠–∫–∑–∞–º–µ–Ω</span>',
        'test': '<span class="badge bg-warning text-dark">–ó–∞—á—ë—Ç</span>',
        'credit': '<span class="badge bg-info">–î–∏—Ñ. –∑–∞—á—ë—Ç</span>',
        'consultation': '<span class="badge bg-secondary">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</span>'
    };
    return badges[eventType] || `<span class="badge bg-light text-dark">${eventType}</span>`;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
async function showAddSessionEventModal() {
    try {
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('addSessionEventForm').reset();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –∏ –≥—Ä—É–ø–ø—ã
        await loadSubjectsForSession();
        await loadGroupsForSession();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('sessionEventDate').valueAsDate = new Date();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('sessionStartTime').value = '09:00';
        document.getElementById('sessionEndTime').value = '10:30';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = new bootstrap.Modal(document.getElementById('addSessionEventModal'));
        modal.show();
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
async function loadSubjectsForSession() {
    try {
        const response = await fetch('/api/subjects', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('sessionSubjectSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = subject.name;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
async function loadGroupsForSession() {
    try {
        const response = await fetch('/api/groups', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('sessionGroupSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = `${group.name} - ${group.specialization || '–û–±—â–∞—è'}`;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
    }
}

// –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
async function addSessionEvent() {
    const formData = {
        subject_id: document.getElementById('sessionSubjectSelect').value,
        group_id: document.getElementById('sessionGroupSelect').value,
        event_type: document.getElementById('sessionEventType').value,
        event_date: document.getElementById('sessionEventDate').value,
        start_time: document.getElementById('sessionStartTime').value,
        end_time: document.getElementById('sessionEndTime').value,
        classroom: document.getElementById('sessionClassroom').value,
        notes: document.getElementById('sessionNotes').value
    };

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!formData.subject_id || !formData.group_id || !formData.event_type || 
        !formData.event_date || !formData.start_time || !formData.end_time) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }

    try {
        const response = await fetch('/api/session-schedule', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!');
            closeAddSessionEventModal();
            await loadSessionSchedule();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è');
    }
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function closeAddSessionEventModal() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('addSessionEventModal'));
    modal.hide();
}

// –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è (—Ä–µ–∞–ª–∏–∑—É–µ–º –ø–æ–∑–∂–µ)
function editSessionEvent(eventId) {
    alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è ${eventId} - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ\n–ü–æ–∫–∞ –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ.`);
}

async function deleteSessionEvent(eventId) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è?')) {
        return;
    }

    try {
        const response = await fetch(`/api/session-schedule/${eventId}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success) {
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ!');
            await loadSessionSchedule();
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è');
    }
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
function closeEditGradeModal() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('editGradeModal'));
    modal.hide();
}

// ==================== –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´ –ü–û–°–ï–©–ê–ï–ú–û–°–¢–ò ====================

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ - –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function loadAttendanceData() {
    try {
        console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUser.role, currentUser);
        
        // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        document.getElementById('attendanceControls').style.display = 'none';
        document.getElementById('studentAttendanceHeader').style.display = 'none';
        document.getElementById('attendanceStats').style.display = 'none';

        // –î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–æ–≤
        if (currentUser.role === 'teacher' || currentUser.role === 'admin') {
            document.getElementById('attendanceControls').style.display = 'block';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
            document.getElementById('attendanceList').innerHTML = `
                <div class="alert alert-info">
                    <h5><i class="bi bi-info-circle"></i> –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h5>
                    <p class="mb-2">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <strong>"–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å"</strong> –¥–ª—è –∑–∞–ø–∏—Å–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤.</p>
                    <p class="mb-0">–°—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–≤–æ—é –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –≤ —ç—Ç–æ–º –∂–µ —Ä–∞–∑–¥–µ–ª–µ.</p>
                </div>
                
                <div class="card mt-3">
                    <div class="card-body">
                        <h6><i class="bi bi-lightbulb"></i> –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é:</h6>
                        <ol class="mb-0">
                            <li>–ù–∞–∂–º–∏—Ç–µ "–û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å"</li>
                            <li>–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç—É</li>
                            <li>–û—Ç–º–µ—Ç—å—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞</li>
                            <li>–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                            <li>–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å"</li>
                        </ol>
                    </div>
                </div>
            `;
            return;
        }
        
        // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        if (currentUser.role === 'student' && currentUser.student_id) {
            document.getElementById('studentAttendanceHeader').style.display = 'block';
            
            const url = `/api/attendance/student/${currentUser.student_id}`;
            console.log('üîç –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:', url);

            const response = await fetch(url, {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            const result = await response.json();
            
            if (result.success && result.data.length > 0) {
                displayAttendanceData(result.data, 'student');
                await loadAttendanceStatistics();
            } else {
                document.getElementById('attendanceList').innerHTML = `
                    <div class="text-center py-5">
                        <div class="mb-3">
                            <i class="bi bi-clipboard-x display-1 text-muted"></i>
                        </div>
                        <h5 class="text-muted">–ó–∞–ø–∏—Å–µ–π –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –Ω–µ—Ç</h5>
                        <p class="text-muted">–í–∞—à–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –µ—â–µ –Ω–µ –æ—Ç–º–µ—á–∞–ª–∞—Å—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏.</p>
                    </div>
                `;
            }
            return;
        }
        
        // –î–ª—è –¥—Ä—É–≥–∏—Ö —Ä–æ–ª–µ–π
        document.getElementById('attendanceList').innerHTML = `
            <div class="alert alert-info">
                <p>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π.</p>
            </div>
        `;
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏:', error);
        document.getElementById('attendanceList').innerHTML = `
            <div class="alert alert-danger">
                <h5>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h5>
                <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏: ${error.message}</p>
            </div>
        `;
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
function displayAttendanceData(attendance, userType) {
    if (attendance.length === 0) {
        document.getElementById('attendanceList').innerHTML = `
            <div class="alert alert-info">
                <p>–ó–∞–ø–∏—Å–∏ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.</p>
            </div>
        `;
        return;
    }

    let html = `
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    attendance.forEach(record => {
        const statusBadge = getAttendanceStatusBadge(record.status);
        const date = new Date(record.date).toLocaleDateString();
        
        html += `
            <tr>
                <td>${date}</td>
                <td>${record.subject_name}</td>
                <td>${statusBadge}</td>
                <td>${record.teacher_name}</td>
                <td>${record.notes || '‚Äî'}</td>
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    document.getElementById('attendanceList').innerHTML = html;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
async function loadAttendanceStatistics() {
    try {
        if (currentUser.role !== 'student' || !currentUser.student_id) return;

        const response = await fetch(`/api/attendance/student/${currentUser.student_id}/statistics`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success) {
            displayAttendanceStatistics(result.data);
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
function displayAttendanceStatistics(stats) {
    const presentCount = stats.by_status.find(s => s.status === 'present')?.count || 0;
    const absentCount = stats.by_status.find(s => s.status === 'absent')?.count || 0;
    const lateCount = stats.by_status.find(s => s.status === 'late')?.count || 0;
    const excusedCount = stats.by_status.find(s => s.status === 'excused')?.count || 0;

    const html = `
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-graph-up"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏</h6>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-3">
                        <div class="border rounded p-3 bg-success bg-opacity-10">
                            <div class="fw-bold text-success fs-4">${stats.present_percentage}%</div>
                            <small class="text-muted">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</small>
                            <div class="mt-1"><small>${presentCount} –∏–∑ ${stats.total}</small></div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3 bg-danger bg-opacity-10">
                            <div class="fw-bold text-danger fs-4">${stats.absent_percentage}%</div>
                            <small class="text-muted">–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</small>
                            <div class="mt-1"><small>${absentCount} –∏–∑ ${stats.total}</small></div>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3 bg-warning bg-opacity-10">
                            <div class="fw-bold text-warning fs-4">${lateCount}</div>
                            <small class="text-muted">–û–ø–æ–∑–¥–∞–ª</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3 bg-info bg-opacity-10">
                            <div class="fw-bold text-info fs-4">${excusedCount}</div>
                            <small class="text-muted">–£–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('attendanceStats').innerHTML = html;
    document.getElementById('attendanceStats').style.display = 'block';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
function getAttendanceStatusBadge(status) {
    const badges = {
        'present': '<span class="badge bg-success">–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>',
        'absent': '<span class="badge bg-danger">–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</span>',
        'late': '<span class="badge bg-warning text-dark">–û–ø–æ–∑–¥–∞–ª</span>',
        'excused': '<span class="badge bg-info">–£–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è</span>'
    };
    return badges[status] || `<span class="badge bg-secondary">${status}</span>`;
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
async function showMarkAttendanceModal() {
    try {
        // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
        document.getElementById('markAttendanceForm').reset();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä—É–ø–ø—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
        await loadGroupsForAttendance();
        await loadSubjectsForAttendance();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('attendanceDate').valueAsDate = new Date();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const modal = new bootstrap.Modal(document.getElementById('markAttendanceModal'));
        modal.show();
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
        alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏');
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
async function loadGroupsForAttendance() {
    try {
        const response = await fetch('/api/groups', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('attendanceGroupSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = `${group.name} - ${group.specialization || '–û–±—â–∞—è'}`;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥—Ä—É–ø–ø:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
async function loadSubjectsForAttendance() {
    try {
        const response = await fetch('/api/subjects', {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        const select = document.getElementById('attendanceSubjectSelect');
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>';
        
        if (result.success && Array.isArray(result.data)) {
            result.data.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = subject.name;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:', error);
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
async function loadStudentsForAttendance() {
    const groupId = document.getElementById('attendanceGroupSelect').value;
    const subjectId = document.getElementById('attendanceSubjectSelect').value;
    const date = document.getElementById('attendanceDate').value;
    
    if (!groupId || !subjectId || !date) {
        document.getElementById('attendanceStudentsList').innerHTML = `
            <div class="alert alert-info">
                <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç—É</p>
            </div>
        `;
        return;
    }

    try {
        document.getElementById('attendanceStudentsList').innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <p class="mt-2">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...</p>
            </div>
        `;

        const response = await fetch(`/api/attendance/group/${groupId}/subject/${subjectId}?date=${date}`, {
            headers: { 'Authorization': `Bearer ${token}` }
        });

        const result = await response.json();
        
        if (result.success) {
            displayStudentsForAttendance(result.data);
        } else {
            document.getElementById('attendanceStudentsList').innerHTML = `
                <div class="alert alert-warning">
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:', error);
        document.getElementById('attendanceStudentsList').innerHTML = `
            <div class="alert alert-danger">
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
            </div>
        `;
    }
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
function displayStudentsForAttendance(data) {
    let html = `
        <h6>–°—Ç—É–¥–µ–Ω—Ç—ã –≥—Ä—É–ø–ø—ã (${data.students.length})</h6>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>–°—Ç—É–¥–µ–Ω—Ç</th>
                        <th>–ó–∞—á—ë—Ç–∫–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    data.students.forEach(student => {
        const currentStatus = student.status || '';
        
        html += `
            <tr>
                <td>${student.student_name}</td>
                <td>${student.student_card || '‚Äî'}</td>
                <td style="width: 200px;">
                    <select class="form-select form-select-sm attendance-status" data-student-id="${student.student_id}">
                        <option value="">‚Äî</option>
                        <option value="present" ${currentStatus === 'present' ? 'selected' : ''}>–ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                        <option value="absent" ${currentStatus === 'absent' ? 'selected' : ''}>–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                        <option value="late" ${currentStatus === 'late' ? 'selected' : ''}>–û–ø–æ–∑–¥–∞–ª</option>
                        <option value="excused" ${currentStatus === 'excused' ? 'selected' : ''}>–£–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è</option>
                    </select>
                </td>
                <td style="width: 250px;">
                    <input type="text" class="form-control form-control-sm attendance-notes" 
                           data-student-id="${student.student_id}" 
                           value="${student.notes || ''}" 
                           placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ...">
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    document.getElementById('attendanceStudentsList').innerHTML = html;
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ - –í–ï–†–°–ò–Ø –° –ü–û–õ–ù–û–ô –û–¢–õ–ê–î–ö–û–ô
async function saveAttendance() {
    console.log('üéØ FRONTEND - –ù–ê–ß–ê–õ–û saveAttendance');
    console.log('üéØ FRONTEND - –¢–æ–∫–µ–Ω:', token ? '–ï—Å—Ç—å' : '–ù–µ—Ç');
    console.log('üéØ FRONTEND - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser);
    
    const groupId = document.getElementById('attendanceGroupSelect').value;
    const subjectId = document.getElementById('attendanceSubjectSelect').value;
    const date = document.getElementById('attendanceDate').value;
    
    console.log('üéØ FRONTEND - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º—ã:', { groupId, subjectId, date });
    
    if (!groupId || !subjectId || !date) {
        console.log('‚ùå FRONTEND - –ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏
    const statusInputs = document.querySelectorAll('.attendance-status');
    const attendanceData = [];
    
    console.log('üéØ FRONTEND - –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ–π:', statusInputs.length);
    
    let hasData = false;
    
    statusInputs.forEach((input, index) => {
        const studentId = input.getAttribute('data-student-id');
        const status = input.value;
        
        console.log(`üéØ FRONTEND - –°—Ç—É–¥–µ–Ω—Ç ${index + 1}:`, { studentId, status });
        
        if (status) {
            hasData = true;
            const notesInput = document.querySelector(`.attendance-notes[data-student-id="${studentId}"]`);
            const notes = notesInput ? notesInput.value : '';
            
            const studentData = {
                student_id: parseInt(studentId),
                status: status,
                notes: notes
            };
            
            attendanceData.push(studentData);
        }
    });
    
    console.log('üéØ FRONTEND - –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', attendanceData);
    
    if (!hasData) {
        console.log('‚ùå FRONTEND - –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–º–µ—Ç—å—Ç–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —Ö–æ—Ç—è –±—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞');
        return;
    }
    
    const requestData = {
        subject_id: parseInt(subjectId),
        group_id: parseInt(groupId),
        date: date,
        attendance_data: attendanceData
    };
    
    console.log('üéØ FRONTEND - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', requestData);
    
    try {
        console.log('üöÄ FRONTEND - –ù–∞—á–∏–Ω–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–∞...');
        
        const url = '/api/attendance/bulk';
        console.log('üöÄ FRONTEND - URL –∑–∞–ø—Ä–æ—Å–∞:', url);
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        });

        console.log('üì° FRONTEND - –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('üìä FRONTEND - –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
        
        if (result.success) {
            console.log('‚úÖ FRONTEND - –£—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ');
            alert(`‚úÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!\n–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${result.data.saved} –∑–∞–ø–∏—Å–µ–π`);
            closeMarkAttendanceModal();
            if (currentUser.role === 'teacher' || currentUser.role === 'admin') {
        document.getElementById('attendanceList').innerHTML = `
            <div class="alert alert-success">
                <h5><i class="bi bi-check-circle"></i> –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞</h5>
                <p>–£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${result.data.saved} –∑–∞–ø–∏—Å–µ–π –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏.</p>
                <button class="btn btn-outline-success btn-sm" onclick="showMarkAttendanceModal()">
                    <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                </button>
            </div>
        `;
    }
        } else {
            console.log('‚ùå FRONTEND - –û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result.error);
            alert('‚ùå –û—à–∏–±–∫–∞: ' + result.error);
        }
    } catch (error) {
        console.error('‚ùå FRONTEND - –û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
        alert('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
    }
}

// –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function closeMarkAttendanceModal() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('markAttendanceModal'));
    modal.hide();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é
function setupAttendanceUI() {
    if (currentUser.role === 'teacher' || currentUser.role === 'admin') {
        document.getElementById('attendanceControls').style.display = 'block';
        document.getElementById('studentAttendanceHeader').style.display = 'none';
        document.getElementById('attendanceStats').style.display = 'none';
    } else if (currentUser.role === 'student') {
        document.getElementById('attendanceControls').style.display = 'none';
        document.getElementById('studentAttendanceHeader').style.display = 'block';
    } else {
        document.getElementById('attendanceControls').style.display = 'none';
        document.getElementById('studentAttendanceHeader').style.display = 'none';
    }
}

// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
window.loadCurrentGrades = loadCurrentGrades;
window.switchToAddGradesTab = switchToAddGradesTab;
window.loadStudentsForGrading = loadStudentsForGrading;
window.submitAllGrades = submitAllGrades;
window.refreshCurrentGrades = refreshCurrentGrades;
window.updateGradingInterface = updateGradingInterface;
window.loadSessionSchedule = loadSessionSchedule;
window.showAddSessionEventModal = showAddSessionEventModal;
window.addSessionEvent = addSessionEvent;
window.closeAddSessionEventModal = closeAddSessionEventModal;
window.editSessionEvent = editSessionEvent;
window.deleteSessionEvent = deleteSessionEvent;
window.loadAttendanceData = loadAttendanceData;
window.showMarkAttendanceModal = showMarkAttendanceModal;
window.loadStudentsForAttendance = loadStudentsForAttendance;
window.saveAttendance = saveAttendance;
window.closeMarkAttendanceModal = closeMarkAttendanceModal;

// –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
window.showMassGrading = showMassGrading;
window.closeMassGradingModal = closeMassGradingModal;
window.loadStudentsForMassGrading = loadStudentsForMassGrading;
window.submitMassGrading = submitMassGrading;
window.showAddGradeModal = showAddGradeModal;
window.showAddCreditModal = showAddCreditModal;
window.submitGrade = submitGrade;
window.submitCredit = submitCredit;
window.deleteGrade = deleteGrade;
window.editGrade = editGrade;
window.closeAddGradeModal = closeAddGradeModal;
window.closeAddCreditModal = closeAddCreditModal;
window.toggleCreditType = toggleCreditType;
window.getGradeTypeText = getGradeTypeText;
window.getGradeColor = getGradeColor;
window.getGradeDisplay = getGradeDisplay;
window.editGrade = editGrade;
window.updateGrade = updateGrade;
window.closeEditGradeModal = closeEditGradeModal;

    </script>

    <style>
        .btn-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-pdf:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .role-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .role-admin {
            background-color: #dc3545;
            color: white;
        }
        .role-teacher {
            background-color: #fd7e14;
            color: white;
        }
        .role-student {
            background-color: #20c997;
            color: white;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –±–µ–∑ Bootstrap */
.modal {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}

.modal.show {
    display: block;
}

.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: 5% auto;
    padding: 0;
    border: 1px solid #888;
    width: 90%;
    max-width: 500px;
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

.modal-header {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-body {
    padding: 1rem;
}

.modal-footer {
    padding: 1rem;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
}

.btn-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    opacity: 0.5;
}

.btn-close:hover {
    opacity: 1;
}

/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
.modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}

.modal.show {
    display: flex !important;
    align-items: center;
    justify-content: center;
}

.modal-dialog {
    margin: 0;
    max-width: 500px;
    width: 90%;
}

.modal-content {
    position: relative;
    background-color: #fefefe;
    border: 1px solid #888;
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    animation: modalShow 0.3s ease;
}

@keyframes modalShow {
    from { opacity: 0; transform: translateY(-50px); }
    to { opacity: 1; transform: translateY(0); }
}

.modal-header {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f8f9fa;
    border-radius: 0.375rem 0.375rem 0 0;
}

.modal-body {
    padding: 1rem;
    max-height: 70vh;
    overflow-y: auto;
}

.modal-footer {
    padding: 1rem;
    border-top: 1px solid #dee2e6;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
    background-color: #f8f9fa;
    border-radius: 0 0 0.375rem 0.375rem;
}

.btn-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    opacity: 0.5;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-close:hover {
    opacity: 1;
    background-color: rgba(0,0,0,0.1);
    border-radius: 50%;
}

/* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã */
.form-select, .form-control, .btn {
    pointer-events: auto !important;
}

/* –ó–∞–ø—Ä–µ—â–∞–µ–º –∫–ª–∏–∫–∏ –Ω–∞ –∑–∞–¥–Ω–µ–º —Ñ–æ–Ω–µ –∫–æ–≥–¥–∞ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–æ */
.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 9998;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0,0,0,0.5);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ */
.tab-content > .tab-pane {
    display: none;
}

.tab-content > .tab-pane.active {
    display: block;
}

.nav-pills .nav-link.active {
    background-color: #0d6efd;
    color: white;
}

.nav-pills .nav-link {
    color: #0d6efd;
    background-color: transparent;
}

/* –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è */
#current-grades:not(.active),
#add-grades:not(.active) {
    display: none !important;
}

#current-grades.active,
#add-grades.active {
    display: block !important;
}

    </style>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ -->
<div class="modal fade" id="addGradeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h5>
                <button type="button" class="btn-close" onclick="closeAddGradeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addGradeForm">
                    <div class="mb-3">
                        <label class="form-label">–°—Ç—É–¥–µ–Ω—Ç *</label>
                        <select class="form-select" id="gradeStudentSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                        <select class="form-select" id="gradeSubjectSelectModal" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø —Ä–∞–±–æ—Ç—ã *</label>
                        <select class="form-select" id="gradeTypeSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                            <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
                            <option value="coursework">–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞</option>
                            <option value="practice">–ü—Ä–∞–∫—Ç–∏–∫–∞</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û—Ü–µ–Ω–∫–∞ *</label>
                        <select class="form-select" id="gradeValueSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É...</option>
                            <option value="5">5 (–û—Ç–ª–∏—á–Ω–æ)</option>
                            <option value="4">4 (–•–æ—Ä–æ—à–æ)</option>
                            <option value="3">3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                            <option value="2">2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–î–∞—Ç–∞ *</label>
                        <input type="date" class="form-control" id="gradeDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-control" id="gradeNotes" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="submitGrade()">–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞—á—ë—Ç–∞ - –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø -->
<div class="modal fade" id="addCreditModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-check"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞—á—ë—Ç</h5>
                <button type="button" class="btn-close" onclick="closeAddCreditModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addCreditForm">
                    <div class="mb-3">
                        <label class="form-label">–°—Ç—É–¥–µ–Ω—Ç *</label>
                        <select class="form-select" id="creditStudentSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                        <select class="form-select" id="creditSubjectSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø –∑–∞—á—ë—Ç–∞ *</label>
                        <select class="form-select" id="creditTypeSelect" required onchange="toggleCreditType()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                            <option value="test">–ó–∞—á—ë—Ç (–∑–∞—á—ë—Ç/–Ω–µ–∑–∞—á—ë—Ç)</option>
                            <option value="credit">–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç (—Å –æ—Ü–µ–Ω–∫–æ–π)</option>
                        </select>
                    </div>
                    
                    <!-- –ë–ª–æ–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∑–∞—á—ë—Ç–∞ -->
                    <div class="mb-3" id="simpleCreditBlock">
                        <label class="form-label">–†–µ–∑—É–ª—å—Ç–∞—Ç *</label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="creditResult" id="creditPass" value="1" required>
                                <label class="form-check-label" for="creditPass">
                                    <span class="badge bg-success">–ó–∞—á—ë—Ç</span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="creditResult" id="creditFail" value="0" required>
                                <label class="form-check-label" for="creditFail">
                                    <span class="badge bg-danger">–ù–µ–∑–∞—á—ë—Ç</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ë–ª–æ–∫ –¥–ª—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞—á—ë—Ç–∞ -->
                    <div class="mb-3" id="diffCreditBlock" style="display: none;">
                        <label class="form-label">–û—Ü–µ–Ω–∫–∞ *</label>
                        <select class="form-select" id="diffGradeSelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É...</option>
                            <option value="5">5 (–û—Ç–ª–∏—á–Ω–æ)</option>
                            <option value="4">4 (–•–æ—Ä–æ—à–æ)</option>
                            <option value="3">3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                            <option value="2">2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–î–∞—Ç–∞ *</label>
                        <input type="date" class="form-control" id="creditDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-control" id="creditNotes" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddCreditModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="submitCredit()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞—á—ë—Ç</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ -->
<div class="modal fade" id="massGradingModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-people"></i> –ú–∞—Å—Å–æ–≤–æ–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h5>
                <button type="button" class="btn-close" onclick="closeMassGradingModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label class="form-label">–ì—Ä—É–ø–ø–∞ *</label>
                        <select class="form-select" id="massGroupSelect" onchange="loadStudentsForMassGrading()" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                        <select class="form-select" id="massSubjectSelect" onchange="loadStudentsForMassGrading()" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">–¢–∏–ø —Ä–∞–±–æ—Ç—ã *</label>
                        <select class="form-select" id="massGradeType" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                            <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
                            <option value="test">–ó–∞—á—ë—Ç</option>
                            <option value="credit">–î–∏—Ñ. –∑–∞—á—ë—Ç</option>
                            <option value="coursework">–ö—É—Ä—Å–æ–≤–∞—è</option>
                            <option value="practice">–ü—Ä–∞–∫—Ç–∏–∫–∞</option>
                        </select>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">–î–∞—Ç–∞ *</label>
                        <input type="date" class="form-control" id="massDate" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">–û–±—â–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <input type="text" class="form-control" id="massNotes" placeholder="–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...">
                    </div>
                </div>
                
                <div id="massGradingTable" class="mt-4">
                    <div class="alert alert-info">
                        <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É –∏ –ø—Ä–µ–¥–º–µ—Ç —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeMassGradingModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-success" onclick="submitMassGrading()">
                    <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ -->
<div class="modal fade" id="editGradeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ü–µ–Ω–∫—É</h5>
                <button type="button" class="btn-close" onclick="closeEditGradeModal()"></button>
            </div>
            <div class="modal-body">
                <form id="editGradeForm">
                    <input type="hidden" id="editGradeId">
                    
                    <div class="mb-3">
                        <label class="form-label">–°—Ç—É–¥–µ–Ω—Ç</label>
                        <input type="text" class="form-control" id="editStudentName" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                        <input type="text" class="form-control" id="editSubjectName" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø —Ä–∞–±–æ—Ç—ã</label>
                        <input type="text" class="form-control" id="editGradeType" readonly>
                    </div>
                    
                    <div class="mb-3" id="editGradeBlock">
                        <label class="form-label">–û—Ü–µ–Ω–∫–∞ *</label>
                        <select class="form-select" id="editGradeValue" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É...</option>
                            <option value="5">5 (–û—Ç–ª–∏—á–Ω–æ)</option>
                            <option value="4">4 (–•–æ—Ä–æ—à–æ)</option>
                            <option value="3">3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                            <option value="2">2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3" id="editCreditBlock" style="display: none;">
                        <label class="form-label">–†–µ–∑—É–ª—å—Ç–∞—Ç *</label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="editCreditResult" id="editCreditPass" value="1" required>
                                <label class="form-check-label" for="editCreditPass">
                                    <span class="badge bg-success">–ó–∞—á—ë—Ç</span>
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="editCreditResult" id="editCreditFail" value="0" required>
                                <label class="form-check-label" for="editCreditFail">
                                    <span class="badge bg-danger">–ù–µ–∑–∞—á—ë—Ç</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–î–∞—Ç–∞ *</label>
                        <input type="date" class="form-control" id="editGradeDate" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-control" id="editGradeNotes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditGradeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="updateGrade()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ -->
<div class="modal fade" id="addSessionEventModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏</h5>
                <button type="button" class="btn-close" onclick="closeAddSessionEventModal()"></button>
            </div>
            <div class="modal-body">
                <form id="addSessionEventForm">
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                        <select class="form-select" id="sessionSubjectSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ì—Ä—É–ø–ø–∞ *</label>
                        <select class="form-select" id="sessionGroupSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è *</label>
                        <select class="form-select" id="sessionEventType" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø...</option>
                            <option value="exam">–≠–∫–∑–∞–º–µ–Ω</option>
                            <option value="test">–ó–∞—á—ë—Ç</option>
                            <option value="credit">–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞—á—ë—Ç</option>
                            <option value="consultation">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
                        </select>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">–î–∞—Ç–∞ *</label>
                            <input type="date" class="form-control" id="sessionEventDate" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ *</label>
                            <input type="time" class="form-control" id="sessionStartTime" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è *</label>
                            <input type="time" class="form-control" id="sessionEndTime" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ê—É–¥–∏—Ç–æ—Ä–∏—è</label>
                        <input type="text" class="form-control" id="sessionClassroom" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê—É–¥–∏—Ç–æ—Ä–∏—è 101">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea class="form-control" id="sessionNotes" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddSessionEventModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="addSessionEvent()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–º–µ—Ç–∫–∏ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ -->
<div class="modal fade" id="markAttendanceModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="bi bi-check2-square"></i> –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h5>
                <button type="button" class="btn-close" onclick="closeMarkAttendanceModal()"></button>
            </div>
            <div class="modal-body">
                <form id="markAttendanceForm">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">–ì—Ä—É–ø–ø–∞ *</label>
                            <select class="form-select" id="attendanceGroupSelect" onchange="loadStudentsForAttendance()" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç *</label>
                            <select class="form-select" id="attendanceSubjectSelect" onchange="loadStudentsForAttendance()" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">–î–∞—Ç–∞ *</label>
                            <input type="date" class="form-control" id="attendanceDate" onchange="loadStudentsForAttendance()" required>
                        </div>
                    </div>

                    <div id="attendanceStudentsList">
                        <div class="alert alert-info">
                            <p class="mb-0">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É, –ø—Ä–µ–¥–º–µ—Ç –∏ –¥–∞—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeMarkAttendanceModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="saveAttendance()">
                    <i class="bi bi-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>